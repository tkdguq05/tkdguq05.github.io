<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>EKS-workshop - Unreasonable Effectiveness</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Unreasonable Effectiveness"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Unreasonable Effectiveness"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="EKSë¥¼ ë‹¤ë¤„ë³´ê³  GitOpsê¹Œì§€ ì‹¤ìŠµí•´ë´¤ìŠµë‹ˆë‹¤."><meta property="og:type" content="article"><meta property="og:title" content="EKS-workshop"><meta property="og:url" content="http://tkdguq05.github.io/2021/11/03/EKS-workshop/"><meta property="og:site_name" content="Unreasonable Effectiveness"><meta property="og:description" content="EKSë¥¼ ë‹¤ë¤„ë³´ê³  GitOpsê¹Œì§€ ì‹¤ìŠµí•´ë´¤ìŠµë‹ˆë‹¤."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://coffeewhale.com/assets/images/k8s-cluster/landing02.png"><meta property="article:published_time" content="2021-11-03T05:40:24.000Z"><meta property="article:modified_time" content="2021-11-03T06:08:22.000Z"><meta property="article:author" content="SangHyub Lee, Jose"><meta property="article:tag" content="k8s"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://coffeewhale.com/assets/images/k8s-cluster/landing02.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://tkdguq05.github.io/2021/11/03/EKS-workshop/"},"headline":"EKS-workshop","image":["https://coffeewhale.com/assets/images/k8s-cluster/landing02.png"],"datePublished":"2021-11-03T05:40:24.000Z","dateModified":"2021-11-03T06:08:22.000Z","author":{"@type":"Person","name":"SangHyub Lee, Jose"},"publisher":{"@type":"Organization","name":"Unreasonable Effectiveness","logo":{"@type":"ImageObject"}},"description":"EKSë¥¼ ë‹¤ë¤„ë³´ê³  GitOpsê¹Œì§€ ì‹¤ìŠµí•´ë´¤ìŠµë‹ˆë‹¤."}</script><link rel="canonical" href="http://tkdguq05.github.io/2021/11/03/EKS-workshop/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Unreasonable Effectiveness</a></div><div class="navbar-menu"><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-03T05:40:24.000Z" title="2021. 11. 3. ì˜¤í›„ 2:40:24">2021-11-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-03T06:08:22.000Z" title="2021. 11. 3. ì˜¤í›„ 3:08:22">2021-11-03</time></span><span class="level-item"><a class="link-muted" href="/categories/Engineering/">Engineering</a></span></div></div><h1 class="title is-3 is-size-4-mobile">EKS-workshop</h1><div class="content"><p>EKSë¥¼ ë‹¤ë¤„ë³´ê³  GitOpsê¹Œì§€ ì‹¤ìŠµí•´ë´¤ìŠµë‹ˆë‹¤.</p>
<a id="more"></a>



<ul>
<li><p>ì‹¤ìŠµ ë§í¬ : <a target="_blank" rel="noopener" href="https://aws-eks-web-application.workshop.aws/ko/10-intro.html">https://aws-eks-web-application.workshop.aws/ko/10-intro.html</a></p>
<p>ì‹¤ìŠµ ì˜ìƒ : <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kb6s0Tmp2CA&ab_channel=AWS%ED%95%9C%EA%B5%AD%EC%82%AC%EC%9A%A9%EC%9E%90%EB%AA%A8%EC%9E%84-AWSKRUG">https://www.youtube.com/watch?v=kb6s0Tmp2CA&amp;ab_channel=AWSí•œêµ­ì‚¬ìš©ìëª¨ì„-AWSKRUG</a></p>
<blockquote>
<p>AWS ì›Œí¬ìƒµì—ì„œëŠ” ë‹¤ìŒ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤.</p>
</blockquote>
<ul>
<li>AWS Cloud9ì„ í†µí•œ ì‹¤ìŠµ í™˜ê²½ êµ¬ì¶•</li>
<li>ë„ì»¤ë¥¼ ì´ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ìƒì„±</li>
<li>ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ECRì— ì—…ë¡œë“œ</li>
<li>Amazon EKS í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ë° ì„œë¹„ìŠ¤ ë°°í¬</li>
<li>Container Insights ì‚¬ìš©í•´ë³´ê¸°</li>
<li>íŒŒë“œ ë° í´ëŸ¬ìŠ¤í„° ì˜¤í†  ìŠ¤ì¼€ì¼ë§</li>
<li>AWS Fargateë¡œ ì„œë¹„ìŠ¤ ì˜¬ë¦¬ê¸°</li>
</ul>
<p><br></br></p>
<h2 id="Kubernetes-k8s"><a href="#Kubernetes-k8s" class="headerlink" title="Kubernetes(k8s)"></a>Kubernetes(k8s)</h2><ul>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆí™”ëœ ì›Œí¬ë¡œë“œì™€ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì´ì‹ì„±ì´ ìˆê³ , í™•ì¥ê°€ëŠ¥í•œ ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì„ ì–¸ì  êµ¬ì„±ê³¼ ìë™í™”ë¥¼ ëª¨ë‘ ìš©ì´í•˜ê²Œ í•´ì£¼ëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ì…ë‹ˆë‹¤.</li>
</ul>
<blockquote>
<p>ğŸŒ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œê³  ì‹¶ë‹¤ë©´ <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">ì—¬ê¸°</a> ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
</blockquote>
<p><img src="/images/eks-workshop/kuber_architecture.png" alt="ì¿ ë²„ë„¤í‹°ìŠ¤_ì•„í‚¤í…ì³"></p>
<ul>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ë°°í¬í•˜ë©´ <strong>í´ëŸ¬ìŠ¤í„°</strong>ë¥¼ ì–»ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ í´ëŸ¬ìŠ¤í„°ëŠ” <strong>ë…¸ë“œë“¤ì˜ ì§‘í•©</strong>ì…ë‹ˆë‹¤. ë…¸ë“œë“¤ì€ í¬ê²Œ ë‘ ê°€ì§€ ìœ í˜•ìœ¼ë¡œ ë‚˜ëˆ ì§€ëŠ”ë°, ê°ê°ì´ <strong>ì»¨íŠ¸ë¡¤ í”Œë ˆì¸</strong>ê³¼ <strong>ë°ì´í„° í”Œë ˆì¸</strong>ì…ë‹ˆë‹¤.<ul>
<li>ì»¨íŠ¸ë¡¤ í”Œë ˆì¸(Control Plane)ì€ ì›Œì»¤ ë…¸ë“œì™€ í´ëŸ¬ìŠ¤í„° ë‚´ íŒŒë“œë¥¼ ê´€ë¦¬í•˜ê³  ì œì–´í•©ë‹ˆë‹¤.</li>
<li>ë°ì´í„° í”Œë ˆì¸(Data Plane)ì€ <strong>ì›Œì»¤ ë…¸ë“œë“¤</strong>ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©° ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì„± ìš”ì†Œì¸ <strong>íŒŒë“œ</strong>ë¥¼ í˜¸ìŠ¤íŠ¸í•©ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
<p><br></br></p>
<h2 id="Kubernetes-Objects"><a href="#Kubernetes-Objects" class="headerlink" title="Kubernetes Objects"></a>Kubernetes Objects</h2><ul>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” <strong>ë°”ë¼ëŠ” ìƒíƒœ(desired state)ë¥¼ ë‹´ì€ ë ˆì½”ë“œ</strong>ì…ë‹ˆë‹¤. ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì—ì„œ ì˜¤ë¸Œì íŠ¸ì˜ <strong>í˜„ì¬ ìƒíƒœ(current state)</strong> ì™€ ë°”ë¼ëŠ” ìƒíƒœë¥¼ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´ ëŠì„ì—†ì´ ê´€ë¦¬í•©ë‹ˆë‹¤.</li>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ì—ëŠ” íŒŒë“œ(pod), ì„œë¹„ìŠ¤(service), ë””í”Œë¡œì´ë¨¼íŠ¸(Deployment) ë“±ì´ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
<p>  <br></br></p>
<h2 id="EKS"><a href="#EKS" class="headerlink" title="EKS"></a>EKS</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html">Amazon EKS</a>ëŠ” Kubernetesë¥¼ ì‰½ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. Amazon EKSë¥¼ ì‚¬ìš©í•˜ì‹œë©´ AWS í™˜ê²½ì—ì„œ Kubernetes ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ë˜ëŠ” ë…¸ë“œë¥¼ ì§ì ‘ ì„¤ì¹˜, ìš´ì˜ ë° ìœ ì§€í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
</li>
<li><p>Amazon EKSëŠ” ì—¬ëŸ¬ ê°€ìš© ì˜ì—­ì—ì„œ Kubernetes ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ê³ ê°€ìš©ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. ë˜í•œ, ë¹„ì •ìƒ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  êµì²´í•˜ë©° ìë™í™”ëœ ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ë° íŒ¨ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
</li>
<li><p>Amazon EKSëŠ” ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ë“¤ê³¼ ì—°ë™í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ í™•ì¥ì„± ë° ë³´ì•ˆì„ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<ul>
<li>ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì €ì¥ì†Œì¸ <strong>Amazon ECR(Elastic Container Registry)</strong></li>
<li>ë¡œë“œ ë¶„ì‚°ì„ ìœ„í•œ <strong>AWS ELB(Elastic Load Balancing)</strong></li>
<li>ì¸ì¦ì„ ìœ„í•œ <strong>AWS IAM</strong></li>
<li>ê²©ë¦¬ëœ <strong>Amazon VPC</strong></li>
</ul>
</li>
<li><p>Amazon EKSëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ Kubernetes ì†Œí”„íŠ¸ì›¨ì–´ì˜ ìµœì‹  ë²„ì „ì„ ì‹¤í–‰í•˜ë¯€ë¡œ <strong>Kubernetes ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì‚¬ìš©ë˜ëŠ” í”ŒëŸ¬ê·¸ì¸ê³¼ íˆ´ì„ ëª¨ë‘ ì‚¬ìš©</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¨í”„ë ˆë¯¸ìŠ¤ ë°ì´í„° ì„¼í„°ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í¼ë¸”ë¦­ í´ë¼ìš°ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ì— ìƒê´€ì—†ì´, Amazon EKSì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í‘œì¤€ Kubernetes í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì™„ë²½í•˜ê²Œ í˜¸í™˜ë©ë‹ˆë‹¤. ì¦‰, ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  í‘œì¤€ Kubernetes ì• í”Œë¦¬ì¼€ì´ì…˜ì„ Amazon EKSë¡œ ì†ì‰½ê²Œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li><p>ì´ ì›Œí¬ìƒµì„ ìœ„í•´ì„œëŠ” administrator IAM  ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p><br></br></p>
<h2 id="Cloud9"><a href="#Cloud9" class="headerlink" title="Cloud9"></a>Cloud9</h2></li>
<li><p>AWS Cloud9ì€ ë¸Œë¼ìš°ì €ë§Œìœ¼ë¡œë„ ì½”ë“œë¥¼ ì‘ì„±, ì‹¤í–‰ ë° ë””ë²„ê¹…í•  ìˆ˜ ìˆëŠ” IDEì…ë‹ˆë‹¤. ì½”ë“œ í¸ì§‘ê¸°, ë””ë²„ê±° ë° í„°ë¯¸ë„ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©° ë§ì´ ì‚¬ìš©ë˜ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ìœ„í•œ í•„ìˆ˜ ë„êµ¬ê°€ ì‚¬ì „ì— íŒ¨í‚¤ì§•ë˜ì–´ ì œê³µë˜ë¯€ë¡œ, ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ íŒŒì¼ì„ ì„¤ì¹˜í•˜ê±°ë‚˜ ê°œë°œ ë¨¸ì‹ ì„ êµ¬ì„±í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p>
<p><br></br></p>
<h3 id="kubectl"><a href="#kubectl" class="headerlink" title="kubectl"></a>kubectl</h3></li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ëª…ë ¹ì„ ë‚´ë¦¬ëŠ” CLIì…ë‹ˆë‹¤.</p>
</li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì˜¤ë¸Œì íŠ¸ ìƒì„±, ìˆ˜ì • í˜¹ì€ ì‚­ì œì™€ ê´€ë ¨í•œ ë™ì‘ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ <strong>ì¿ ë²„ë„¤í‹°ìŠ¤ API</strong>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë•Œ, kubectl CLIë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ëª…ë ¹ì–´ê°€ ì¿ ë²„ë„¤í‹°ìŠ¤ APIë¥¼ í˜¸ì¶œí•´ ê´€ë ¨ ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
<p><br></br></p>
<h3 id="eksctl"><a href="#eksctl" class="headerlink" title="eksctl"></a>eksctl</h3></li>
<li><p><a target="_blank" rel="noopener" href="https://eksctl.io/">eksctl</a>ì´ë€ EKS í´ëŸ¬ìŠ¤í„°ë¥¼ ì‰½ê²Œ ìƒì„± ë° ê´€ë¦¬í•˜ëŠ” CLI íˆ´ì…ë‹ˆë‹¤. Go ì–¸ì–´ë¡œ ì“°ì—¬ ìˆìœ¼ë©° CloudFormation í˜•íƒœë¡œ ë°°í¬ë©ë‹ˆë‹¤.</p>
<h3 id="eksctlë¡œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±í•˜ê¸°"><a href="#eksctlë¡œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±í•˜ê¸°" class="headerlink" title="eksctlë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„±í•˜ê¸°"></a>eksctlë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„±í•˜ê¸°</h3></li>
<li><p>eksctlì„ ì‚¬ìš©í•˜ì—¬ ì•„ë¬´ ì„¤ì • ê°’ì„ ì£¼ì§€ ì•Šê³  ì´ ëª…ë ¹ì–´(<code>eksctl create cluster</code>)ë¥¼ ì‹¤í–‰í•˜ë©´ default parameterë¡œ í´ëŸ¬ìŠ¤í„°ê°€ ë°°í¬ë©ë‹ˆë‹¤.</p>
</li>
<li><p>ì›í•˜ëŠ” ì„¤ì •ì´ ìˆë‹¤ë©´ yamlíŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ë°°í¬í•˜ë©´ ë©ë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;</span> <span class="string">EOF</span> <span class="string">&gt; eks-demo-cluster.yaml</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">eksctl.io/v1alpha5</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfig</span></span><br><span class="line"></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">eks-demo</span> <span class="comment"># ìƒì„±í•  EKS í´ëŸ¬ìŠ¤í„°ëª…</span></span><br><span class="line"><span class="attr">  region:</span> <span class="string">$&#123;AWS_REGION&#125;</span> <span class="comment"># í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ë¦¬ì ¼</span></span><br><span class="line"><span class="attr">  version:</span> <span class="string">"1.21"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">vpc:</span></span><br><span class="line"><span class="attr">  cidr:</span> <span class="string">"192.168.0.0/16"</span> <span class="comment"># í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‚¬ìš©í•  VPCì˜ CIDR</span></span><br><span class="line"></span><br><span class="line"><span class="attr">managedNodeGroups:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">node-group</span> <span class="comment"># í´ëŸ¬ìŠ¤í„°ì˜ ë…¸ë“œ ê·¸ë£¹ëª…</span></span><br><span class="line"><span class="attr">    instanceType:</span> <span class="string">m5.large</span> <span class="comment"># í´ëŸ¬ìŠ¤í„° ì›Œì»¤ ë…¸ë“œì˜ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…</span></span><br><span class="line"><span class="attr">    desiredCapacity:</span> <span class="number">3</span> <span class="comment"># í´ëŸ¬ìŠ¤í„° ì›Œì»¤ ë…¸ë“œì˜ ê°¯ìˆ˜</span></span><br><span class="line"><span class="attr">    volumeSize:</span> <span class="number">10</span>  <span class="comment"># í´ëŸ¬ìŠ¤í„° ì›Œì»¤ ë…¸ë“œì˜ EBS ìš©ëŸ‰ (ë‹¨ìœ„: GiB)</span></span><br><span class="line"><span class="attr">    ssh:</span></span><br><span class="line"><span class="attr">      enableSsm:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    iam:</span></span><br><span class="line"><span class="attr">      withAddonPolicies:</span></span><br><span class="line"><span class="attr">        imageBuilder:</span> <span class="literal">true</span> <span class="comment"># AWS ECRì— ëŒ€í•œ ê¶Œí•œ ì¶”ê°€</span></span><br><span class="line">        <span class="comment"># albIngress: true  # albIngressì— ëŒ€í•œ ê¶Œí•œ ì¶”ê°€</span></span><br><span class="line"><span class="attr">        cloudWatch:</span> <span class="literal">true</span> <span class="comment"># cloudWatchì— ëŒ€í•œ ê¶Œí•œ ì¶”ê°€</span></span><br><span class="line"><span class="attr">        autoScaler:</span> <span class="literal">true</span> <span class="comment"># auto scalingì— ëŒ€í•œ ê¶Œí•œ ì¶”ê°€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cloudWatch:</span></span><br><span class="line"><span class="attr">  clusterLogging:</span></span><br><span class="line"><span class="attr">    enableTypes:</span> <span class="string">["*"]</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>eksctl create cluster -f eks-demo-cluster.yaml</code> ë¡œ ë°°í¬</p>
</li>
<li><p>ë…¸ë“œ í™•ì¸</p>
<ul>
<li><p><code>kubectl get nodes</code></p>
<p><img src="/images/eks-workshop/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2021-10-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.17.55.png" alt="EKSí´ëŸ¬ìŠ¤í„° êµ¬ì„±"></p>
<ul>
<li>ê¸°ë³¸ì ì¸ EKS í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì€ ëë‚¬ê³ , ë³¸ê²©ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ê³ , ìœ ì €ê°€ ë“¤ì–´ì˜¤ëŠ” í†µë¡œì¸ ì¸ê·¸ë ˆìŠ¤ë¥¼ ì„¤ì •í•´ ë´…ì‹œë‹¤.</li>
</ul>
</li>
</ul>
</li>
<li><p>ì´ ìƒíƒœì—ì„œëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ë…¸ë“œë¥¼ UIì—ì„œ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Console Credientialì„ ë”í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.</p>
</li>
<li><p>Cloud9ì˜ IAM credentialì„ í†µí•´, í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•˜ì˜€ê¸° ë•Œë¬¸ì— <a target="_blank" rel="noopener" href="https://console.aws.amazon.com/eks">Amazon EKS ì½˜ì†”ì°½</a>ì—ì„œ í•´ë‹¹ í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” ì‹¤ì œ ì½˜ì†”ì— ì ‘ê·¼í•  IAM entity(ì‚¬ìš©ì ë˜ëŠ” ì—­í• )ì˜ AWS Console credentialì„ í´ëŸ¬ìŠ¤í„°ì— ì¶”ê°€í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<ul>
<li><code>rolearn=$(aws cloud9 describe-environment-memberships --environment-id=$C9_PID | jq -r &#39;.memberships[].userArn&#39;)</code></li>
<li><code>assumedrolename=$(echo ${rolearn} | awk -F/ &#39;{print $(NF-1)}&#39;)
rolearn=$(aws iam get-role --role-name ${assumedrolename} --query Role.Arn --output text)</code> rolearnì— ìì‹ ì˜ arnì„ ë„£ì–´ì£¼ë„ë¡ í•©ì‹œë‹¤.</li>
<li>echo ${rolearn}</li>
<li><code>eksctl create iamidentitymapping --cluster eks-demo --arn ${rolearn} --group system:masters --username admin</code> identity ë§µí•‘</li>
<li>kubectl describe configmap -n kube-system aws-auth ì ìš© í™•ì¸</li>
</ul>
<p><br></br></p>
<h2 id="Ingress-Controller"><a href="#Ingress-Controller" class="headerlink" title="Ingress Controller"></a>Ingress Controller</h2></li>
<li><p><strong>AWS Load Balancer Controller</strong>ëŠ” <strong>êµ¬ AWS ALB Ingress Controller</strong>ì—ì„œ ë¦¬ë¸Œëœë“œëœ ê°œë…ì…ë‹ˆë‹¤.</p>
</li>
<li><p><strong>ì¸ê·¸ë ˆìŠ¤(Ingress)</strong> ëŠ” ì£¼ë¡œ <strong>í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€</strong>ë¡œ ì ‘ê·¼í•  ë•Œ, ìš”ì²­ë“¤ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì •ì˜í•´ë†“ì€ ê·œì¹™ì´ì ë¦¬ì†ŒìŠ¤ ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. í•œë§ˆë””ë¡œ ì™¸ë¶€ì˜ ìš”ì²­ì´ ë‚´ë¶€ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê´€ë¬¸ì˜ ì—­í• ì„ í•˜ëŠ” ê²ƒì´ì£ . ì™¸ë¶€ ìš”ì²­ì— ëŒ€í•œ ë¡œë“œ ë°¸ëŸ°ì‹±, TLS/SSL ì¸ì¦ì„œ ì²˜ë¦¬, HTTP ê²½ë¡œì— ëŒ€í•œ ë¼ìš°íŒ… ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¸ê·¸ë ˆìŠ¤ëŠ” L7 ì˜ì—­ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
</li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì„œë¹„ìŠ¤ íƒ€ì… ì¤‘, NodePort í˜¹ì€ LoadBalancerë¡œë„ ì™¸ë¶€ë¡œ ë…¸ì¶œí•  ìˆ˜ ìˆì§€ë§Œ ì¸ê·¸ë ˆìŠ¤ ì—†ì´ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ê²½ìš°, ëª¨ë“  ì„œë¹„ìŠ¤ì—ê²Œ ë¼ìš°íŒ… ê·œì¹™ ë° TLS/SSL ë“±ì˜ ìƒì„¸í•œ ì˜µì…˜ë“¤ì„ ì ìš©í•´ì•¼ ë˜ì£ . ê·¸ë˜ì„œ ì¸ê·¸ë ˆìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p><img src="/images/eks-workshop/Untitled.png" alt="Ingress"></p>
</li>
<li><p>ì¸ê·¸ë ˆìŠ¤ëŠ” ì™¸ë¶€ ìš”ì²­ ì²˜ë¦¬ì— ëŒ€í•œ ê·œì¹™ë“¤ì„ ì„¤ì •í•´ë†“ì€ ê²ƒì„ ì˜ë¯¸í•˜ë©°, ì´ëŸ° ì„¤ì •ì´ ë™ì‘í•˜ê¸° ìœ„í•´ì„œ í•„ìš”í•œ ê²ƒì´ <strong>ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬</strong>ì…ë‹ˆë‹¤. kube-controller-managerì˜ ì¼ë¶€ë¡œ ì‹¤í–‰ë˜ëŠ” ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë‹¬ë¦¬ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” í´ëŸ¬ìŠ¤í„°ì™€ í•¨ê»˜ ìƒì„±ë˜ì§„ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<h3 id="AWS-Load-Balancer-ë§Œë“¤ê¸°"><a href="#AWS-Load-Balancer-ë§Œë“¤ê¸°" class="headerlink" title="AWS Load Balancer ë§Œë“¤ê¸°"></a>AWS Load Balancer ë§Œë“¤ê¸°</h3></li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html">Amazon EKSì˜ Application Load Balancing</a>ì´ë€ í´ëŸ¬ìŠ¤í„°ì— ì¸ê·¸ë ˆìŠ¤ ìì›ì´ ìƒì„±ë  ë•Œì— ALB(Application Load Balancer) ë° í•„ìš”í•œ ìì›ì´ ìƒì„±ë˜ë„ë¡ íŠ¸ë¦¬ê±°í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì…ë‹ˆë‹¤. ì¸ê·¸ë ˆìŠ¤ ìì›ë“¤ì€ ALBë¥¼ êµ¬ì„±í•˜ì—¬ HTTP ë˜ëŠ” HTTPS íŠ¸ë˜í”½ì„ í´ëŸ¬ìŠ¤í„° ë‚´ íŒŒë“œë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.</p>
<ul>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ <code>Ingress</code>ì˜ ê²½ìš°, <code>Application Load Balancers</code>ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ë©ë‹ˆë‹¤.</li>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ <code>Service</code>ì˜ ê²½ìš°, <code>Network Load Balancers</code>ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ë©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><p>AWS Load Balancer ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§€ì›í•˜ëŠ” <strong>íŠ¸ë˜í”½ ëª¨ë“œ</strong>ëŠ” ì•„ë˜ì˜ ë‘ ê°€ì§€ì…ë‹ˆë‹¤.</p>
<ul>
<li>Instance(default): í´ëŸ¬ìŠ¤í„° ë‚´ ë…¸ë“œë¥¼ ALBì˜ ëŒ€ìƒìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤. ALBì— ë„ë‹¬í•˜ëŠ” íŠ¸ë˜í”½ì€ NodePortë¡œ ë¼ìš°íŒ…ëœ ë‹¤ìŒ íŒŒë“œë¡œ í”„ë¡ì‹œë©ë‹ˆë‹¤.</li>
<li>IP: íŒŒë“œë¥¼ ALB ëŒ€ìƒìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤. ALBì— ë„ë‹¬í•˜ëŠ” íŠ¸ë˜í”½ì€ íŒŒë“œë¡œ <strong>ì§ì ‘</strong> ë¼ìš°íŒ…ë©ë‹ˆë‹¤. í•´ë‹¹ íŠ¸ë˜í”½ ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  <strong>ingress.yaml íŒŒì¼ì— ì£¼ì„ì„ ì‚¬ìš©í•˜ì—¬ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•´ì•¼</strong> í•©ë‹ˆë‹¤.</li>
</ul>
<p>![Instance Mode, IP Mode](/images/eks-workshop/Untitled 1.png)</p>
<ul>
<li>ê°ì¢… ë°°í¬ë“¤ì— ì‚¬ìš©í•  manifests ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ì–´ë†“ê³  ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><p>AWS Load Balancer ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë°°í¬í•˜ê¸° ì „, ìš°ë¦¬ëŠ” ëª‡ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. controllerê°€ ì›Œì»¤ ë…¸ë“œ ìœ„ì—ì„œ ë™ì‘ë˜ê¸° ë•Œë¬¸ì— IAM permissionsë¥¼ í†µí•´, AWS ALB/NLB ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. IAM permissionsëŠ” ServiceAccountë¥¼ ìœ„í•œ IAM rolesë¥¼ ì„¤ì¹˜í•˜ê±°ë‚˜ ì›Œì»¤ ë…¸ë“œì˜ IAM rolesì— ì§ì ‘ì ìœ¼ë¡œ ë¶™ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li><p>ë¨¼ì €, í´ëŸ¬ìŠ¤í„°ì— ëŒ€í•œ <strong>IAM OIDC(OpenID Connect) identity Provider</strong>ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. Podì™€ ê°™ì€ í´ëŸ¬ìŠ¤í„° ë‚´ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìƒì„±í•œ í•­ëª©ì´ API Server ë˜ëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ì¸ì¦í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” <strong><a target="_blank" rel="noopener" href="https://kubernetes.io/ko/docs/reference/access-authn-authz/service-accounts-admin/">service account</a></strong>ì— IAM roleì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´, ìƒì„±í•œ í´ëŸ¬ìŠ¤í„°(í˜„ì¬ ì‹¤ìŠµì—ì„œì˜ <em>eks-demo</em>)ì— <strong>IAM OIDC provider</strong>ê°€ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<ul>
<li><p>eksctl utils associate-iam-oidc-provider <br>â€“region ${AWS_REGION} <br>â€“cluster eks-demo <br>â€“approve</p>
</li>
<li><p>OIDC provider URL</p>
<ul>
<li>aws eks describe-cluster â€“name eks-demo â€“query â€œcluster.identity.oidc.issuerâ€ â€“output text</li>
<li>output: <a target="_blank" rel="noopener" href="https://oidc.eks.ap-northeast-2.amazonaws.com/id/8A6E78112D7F1C4DC352B1B511DD13CF">https://oidc.eks.ap-northeast-2.amazonaws.com/id/8A6E78112D7F1C4DC352B1B511DD13CF</a><ul>
<li>ë’¤ì— id ë¶€ë¶„ì„ ë³µì‚¬í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•©ë‹ˆë‹¤.</li>
<li>aws iam list-open-id-connect-providers | grep 8A6E78112D7F1C4DC352B1B511DD13CF</li>
<li>ê²°ê³¼ ê°’ì´ ì¶œë ¥ë˜ë©´ <strong>IAM OIDC identity provider</strong>ê°€ í´ëŸ¬ìŠ¤í„°ì— ìƒì„±ì´ ëœ ê²ƒì´ê³ , ì•„ë¬´ ê°’ë„ ë‚˜íƒ€ë‚˜ì§€ ì•Šìœ¼ë©´ ìƒì„± ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
</li>
<li><p>AWS Load Balancer Controllerì— ë¶€ì—¬í•  IAM Policyë¥¼ ìƒì„±í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
<ul>
<li>aws iam create-policy <br>â€“policy-name AWSLoadBalancerControllerIAMPolicy <br>â€“policy-document <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/main/docs/install/iam_policy.json">https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/main/docs/install/iam_policy.json</a></li>
</ul>
</li>
<li><p>AWS Load Balancer Controllerë¥¼ ìœ„í•œ ServiceAccountë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
<ul>
<li>eksctl create iamserviceaccount <br>â€“cluster eks-demo <br>â€“namespace kube-system <br>â€“name aws-load-balancer-controller <br>â€“attach-policy-arn arn:aws:iam::$ACCOUNT_ID:policy/AWSLoadBalancerControllerIAMPolicy <br>â€“override-existing-serviceaccounts <br>â€“approve</li>
</ul>
</li>
<li><p>AWS Load Balancer controllerë¥¼ í´ëŸ¬ìŠ¤í„°ì— ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë¨¼ì €, ì¸ì¦ì„œ êµ¬ì„±ì„ ì›¹í›…ì— ì‚½ì…í•  ìˆ˜ ìˆë„ë¡ <strong><a target="_blank" rel="noopener" href="https://github.com/jetstack/cert-manager">cert-manager</a></strong>ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. <strong>Cert-manager</strong>ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ TLSì¸ì¦ì„œë¥¼ ìë™ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ ë° ê´€ë¦¬í•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ì…ë‹ˆë‹¤.</p>
<ul>
<li>kubectl apply â€“validate=false -f <a target="_blank" rel="noopener" href="https://github.com/jetstack/cert-manager/releases/download/v1.4.1/cert-manager.yaml">https://github.com/jetstack/cert-manager/releases/download/v1.4.1/cert-manager.yaml</a></li>
</ul>
</li>
<li><p>load balancer controller yaml</p>
<ul>
<li>wget <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.2.1/docs/install/v2_2_1_full.yaml">https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.2.1/docs/install/v2_2_1_full.yaml</a></li>
</ul>
</li>
<li><p>yaml íŒŒì¼ì—ì„œ í´ëŸ¬ìŠ¤í„°ì˜ <code>cluster-name</code>ì„ í¸ì§‘í•©ë‹ˆë‹¤. ë³¸ ì‹¤ìŠµì—ì„œëŠ” <strong>eks-demo</strong>ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p>
<ul>
<li>spec:<br>containers:</li>
<li>args:</li>
<li>â€“cluster-name=eks-demo # ìƒì„±í•œ í´ëŸ¬ìŠ¤í„° ì´ë¦„ì„ ì…ë ¥</li>
<li>â€“ingress-class=alb<br>image: amazon/aws-alb-ingress-controller:v2.2.0</li>
</ul>
</li>
<li><p>ServiceAccount yaml spec ì‚­ì œ</p>
<ul>
<li>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>labels:<br><a target="_blank" rel="noopener" href="http://app.kubernetes.io/component:">app.kubernetes.io/component:</a> controller<br><a target="_blank" rel="noopener" href="http://app.kubernetes.io/name:">app.kubernetes.io/name:</a> aws-load-balancer-controller<br>name: aws-load-balancer-controller<br>namespace: kube-system</li>
</ul>
<hr>
</li>
</ul>
</li>
<li><p>ë°°í¬</p>
<ul>
<li><code>kubectl apply -f v2_2_1_full.yaml</code></li>
<li>í™•ì¸ kubectl get deployment -n kube-system aws-load-balancer-controller</li>
<li>ì„œë¹„ìŠ¤ ì–´ì¹´ìš´ë“œ í™•ì¸ kubectl get sa aws-load-balancer-controller -n kube-system -o yaml</li>
</ul>
</li>
<li><p>í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ìœ„í•´ ì‹¤í–‰ë˜ëŠ” íŒŒë“œë“¤ì„ <strong>ì• ë“œì˜¨(Addon)</strong> ì´ë¼ê³  í•©ë‹ˆë‹¤. ì• ë“œì˜¨ì— ì‚¬ìš©ë˜ëŠ” íŒŒë“œë“¤ì€ ë””í”Œë¡œì´ë¨¼íŠ¸, ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ ë“±ì— ì˜í•´ ê´€ë¦¬ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ ì• ë“œì˜¨ì´ ì‚¬ìš©í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ <strong>kube-system</strong>ì…ë‹ˆë‹¤. Yaml íŒŒì¼ì—ì„œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ kube-systemìœ¼ë¡œ ëª…ì‹œí–ˆê¸°ì— ìœ„ì˜ ëª…ë ¹ì–´ë¡œ íŒŒë“œ ì´ë¦„ì´ ë„ì¶œë˜ë©´ ì •ìƒì ìœ¼ë¡œ ë°°í¬ëœ ê²ƒì…ë‹ˆë‹¤. ë˜í•œ, ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ ê´€ë ¨ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>kubectl logs -n kube-system $(kubectl get po -n kube-system | egrep -o â€œaws-load-balancer[a-zA-Z0-9-]+â€)</li>
<li>ALBPOD=$(kubectl get pod -n kube-system | egrep -o â€œaws-load-balancer[a-zA-Z0-9-]+â€)</li>
<li>kubectl describe pod -n kube-system ${ALBPOD}</li>
</ul>
<p><br></br></p>
<h2 id="ì„œë¹„ìŠ¤-ë°°í¬"><a href="#ì„œë¹„ìŠ¤-ë°°í¬" class="headerlink" title="ì„œë¹„ìŠ¤ ë°°í¬"></a>ì„œë¹„ìŠ¤ ë°°í¬</h2></li>
<li><p>ì„œë¹„ìŠ¤ ë°°í¬í•˜ëŠ” ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<p>![ì„œë¹„ìŠ¤ ë°°í¬ ìˆœì„œ](/images/eks-workshop/Untitled 2.png)</p>
</li>
<li><p>ì†ŒìŠ¤ ì½”ë“œ ë‹¤ìš´ë¡œë“œ</p>
</li>
<li><p>Amazon ECRì— ê° ì„œë¹„ìŠ¤ì— ëŒ€í•œ ë¦¬í¬ì§€í† ë¦¬ ìƒì„±</p>
</li>
<li><p>Dockerfileì„ í¬í•¨í•œ ì†ŒìŠ¤ ì½”ë“œ ìœ„ì¹˜ì—ì„œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ í›„, ë¦¬í¬ì§€í† ë¦¬ì— í‘¸ì‹œ</p>
</li>
<li><p>ê° ì„œë¹„ìŠ¤ì— ëŒ€í•œ Deployment, Service, Ingress ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ìƒì„± ë° ë°°í¬</p>
</li>
<li><p>ì‚¬ìš©ìê°€ ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ ì ‘ê·¼í•˜ëŠ” ìˆœì„œ</p>
<p>![ì‚¬ìš©ìê°€ ì ‘ê·¼í•˜ëŠ” ìˆœì„œ](/images/eks-workshop/Untitled 3.png)</p>
</li>
<li><p>ìš°ë¦¬ì˜ ì„œë¹„ìŠ¤ëŠ” ë‘ ê°œì˜ ë°±ì—”ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p>
<ul>
<li>Flask</li>
<li>Node.js</li>
</ul>
</li>
<li><p>ê° ë°±ì—”ë“œì˜ APIê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ë¡œ ë„˜ì–´ê°€ë´…ì‹œë‹¤.</p>
</li>
</ul>
<p>  <br></br></p>
<h3 id="Flask-ë°°í¬"><a href="#Flask-ë°°í¬" class="headerlink" title="Flask ë°°í¬"></a>Flask ë°°í¬</h3><ul>
<li><p>cd ~/environment/manifests/</p>
</li>
<li><p>deploy manifest</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">flask-deployment.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-flask-backend:latest</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">flask-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/contents/aws"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">     app:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Ingress manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ingress.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"backend-ingress"</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">alb</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/scheme:</span> <span class="string">internet-facing</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/target-type:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/contents</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-flask-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ìˆœì„œëŒ€ë¡œ ë°°í¬</p>
</li>
<li><p><code>kubectl apply -f flask-deployment.yaml
kubectl apply -f flask-service.yaml
kubectl apply -f ingress.yaml</code></p>
</li>
<li><p>echo <a target="_blank" rel="noopener" href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=â€™{.status.loadBalancer.ingress[*].hostname}â€™)/contents/aws ì—¬ê¸°ì„œ ë‚˜ì˜¨ ì£¼ì†Œë¡œ í™•ì¸</p>
<ul>
<li>ingress objectê°€ ë°°í¬ë˜ëŠ” ë™ì•ˆ ê¸°ë‹¤ë¦¬ê³  ì£¼ì†Œë¡œ ì ‘ì†</li>
</ul>
<p>![flask ë°±ì—”ë“œ ë°°í¬](/images/eks-workshop/Untitled 4.png)</p>
<p><br></br></p>
<h3 id="node-js-ë°°í¬"><a href="#node-js-ë°°í¬" class="headerlink" title="node.js ë°°í¬"></a>node.js ë°°í¬</h3></li>
<li><p><strong>deploy manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">nodejs-deployment.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">public.ecr.aws/y7c9e1d2/joozero-repo:latest</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">3000</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">nodejs-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/services/all"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">     app:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">      protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ingress manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ingress.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"backend-ingress"</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">alb</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/scheme:</span> <span class="string">internet-facing</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/target-type:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/contents</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-flask-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line">					<span class="comment"># ì¶”ê°€ëœ ë¶€ë¶„ í™•ì¸</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/services</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-nodejs-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ìˆœì„œëŒ€ë¡œ ë°°í¬</p>
<ul>
<li><p><code>kubectl apply -f nodejs-deployment.yaml
kubectl apply -f nodejs-service.yaml
kubectl apply -f ingress.yaml</code></p>
</li>
<li><p>echo <a target="_blank" rel="noopener" href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=â€™{.status.loadBalancer.ingress[*].hostname}â€™)/services/all</p>
<p>![node.js ë°±ì—”ë“œ ë°°í¬](/images/eks-workshop/Untitled 5.png)</p>
</li>
</ul>
<p><br></br></p>
<h3 id="í”„ë¡ íŠ¸ì—”ë“œ-ë°°í¬"><a href="#í”„ë¡ íŠ¸ì—”ë“œ-ë°°í¬" class="headerlink" title="í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬"></a>í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬</h3></li>
<li><p>í”„ë¡ íŠ¸ì—”ë“œ ì†ŒìŠ¤ ë‹¤ìš´</p>
<p>cd /home/ec2-user/environment<br>git clone <a target="_blank" rel="noopener" href="https://github.com/joozero/amazon-eks-frontend.git">https://github.com/joozero/amazon-eks-frontend.git</a></p>
</li>
<li><p>ecr repository ìƒì„±</p>
<p>aws ecr create-repository <br>â€“repository-name demo-frontend <br>â€“image-scanning-configuration scanOnPush=true <br>â€“region ${AWS_REGION}</p>
</li>
<li><p>í”„ë¡ íŠ¸ì—”ë“œ ì†ŒìŠ¤ì—ì„œ urlì„ ë°±ì—”ë“œì˜ ingress ì£¼ì†Œë¡œ ë³€ê²½\</p>
<ul>
<li>App.js<ul>
<li>echo <a target="_blank" rel="noopener" href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=â€™{.status.loadBalancer.ingress[*].hostname}â€™)/contents/â€˜${search}â€™</li>
</ul>
</li>
<li>page/UpperPage.js<ul>
<li>echo <a target="_blank" rel="noopener" href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=â€™{.status.loadBalancer.ingress[*].hostname}â€™)/services/all</li>
</ul>
</li>
</ul>
</li>
<li><p>cd /home/ec2-user/environment/amazon-eks-frontend<br>npm install<br>npm run build</p>
</li>
<li><p>npm audit fixë¥¼ í•´ë„ ì•ˆëœë‹¤ë©´</p>
<ul>
<li><code>export NODE_OPTIONS=--openssl-legacy-provider</code></li>
</ul>
</li>
<li><p>ECR demo-fronted ë¡œ ë„¤ì´ë° í•œ ë’¤, í‘¸ì‰¬</p>
<ul>
<li>docker build -t demo-frontend .</li>
<li>docker tag demo-frontend:latest$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</li>
<li>docker push $ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</li>
</ul>
</li>
<li><p><strong>frontedë°°í¬ manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/home/ec2-user/environment/manifests</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-deployment.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ingress ë°°í¬</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ingress.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"backend-ingress"</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">alb</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/scheme:</span> <span class="string">internet-facing</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/target-type:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/contents</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-flask-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/services</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span>  </span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-nodejs-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-frontend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ë°°í¬</p>
<ul>
<li><code>kubectl apply -f frontend-deployment.yaml
kubectl apply -f frontend-service.yaml
kubectl apply -f ingress.yaml</code></li>
</ul>
<p>![í”„ë¡ íŠ¸ê¹Œì§€ ë°°í¬ ì™„ë£Œ](/images/eks-workshop/Untitled 6.png)</p>
<img src="/images/eks-workshop/Untitled 7.png" alt="ëª¨ë“  ë°°í¬ê°€ ì™„ë£Œëœ ëª¨ìŠµ" style="zoom:80%;" />

<p><br></br></p>
<h2 id="Fargate"><a href="#Fargate" class="headerlink" title="Fargate"></a>Fargate</h2></li>
</ul>
<p>  <strong>AWS Fargate</strong>ëŠ” ì»¨í…Œì´ë„ˆì— ì í•©í•œ ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… ì—”ì§„ìœ¼ë¡œ Amazon Elastic Container Service(ECS) ë° Amazon Elastic Kubernetes Service(EKS)ì—ì„œ ëª¨ë‘ ì‘ë™í•©ë‹ˆë‹¤. FargateëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ëŠ” ë° ë³´ë‹¤ ì‰½ê²Œ ì´ˆì ì„ ë§ì¶œ ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤. Fargateì—ì„œëŠ” ì„œë²„ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê³  ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •í•˜ê³  ê´€ë ¨ ë¹„ìš©ì„ ì§€ë¶ˆí•  ìˆ˜ ìˆìœ¼ë©°, ê³„íšì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê²©ë¦¬í•¨ìœ¼ë¡œì¨ ë³´ì•ˆ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li><p>í´ëŸ¬ìŠ¤í„°ì— Fargateë¡œ podë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ì„œëŠ” podê°€ ì‹¤í–‰ë  ë•Œ ì‚¬ìš©í•˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ fargate profileì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì¦‰, fargate profileì´ë€ fargateë¡œ podë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì¡°ê±´ì„ ëª…ì‹œí•´ë†“ì€ í”„ë¡œíŒŒì¼ì´ë¼ê³  ë³´ì‹œë©´ ë©ë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/home/ec2-user/environment/manifestscat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">eks-demo-fargate-profile.yaml---apiVersion:</span> <span class="string">eksctl.io/v1alpha5kind:</span> <span class="attr">ClusterConfigmetadata:</span>  <span class="attr">name:</span> <span class="string">eks-demo</span>  <span class="attr">region:</span> <span class="string">$&#123;AWS_REGION&#125;fargateProfiles:</span>  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">frontend-fargate-profile</span>    <span class="attr">selectors:</span>      <span class="bullet">-</span> <span class="attr">namespace:</span> <span class="string">default</span>        <span class="attr">labels:</span>          <span class="attr">app:</span> <span class="string">frontend-fargateEOF</span></span><br></pre></td></tr></table></figure>

<ul>
<li>yaml íŒŒì¼ì—ì„œ <strong>selectors</strong>ì— ê¸°ì¬ëœ ì¡°ê±´ì— ë¶€í•©í•˜ëŠ” podì˜ ê²½ìš°, fargateë¡œ ë°°í¬ë©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><p>ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´, fargate profileì„ í”„ë¡œë¹„ì €ë‹í•©ë‹ˆë‹¤.</p>
<ul>
<li>eksctl create fargateprofile -f eks-demo-fargate-profile.yaml</li>
<li>ì •ìƒ ë™ì‘ í™•ì¸<ul>
<li>eksctl get fargateprofile â€“cluster eks-demo -o json</li>
</ul>
</li>
</ul>
</li>
<li><p>ë°°í¬í•œ 3ê°œì˜ pod ì¤‘, í”„ë¡ íŠ¸ì•¤ë“œ podë¥¼ fargateë¡œ í”„ë¡œë¹„ì €ë‹í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ê² ìŠµë‹ˆë‹¤. ë¨¼ì €, ê¸°ì¡´ì˜ podë¥¼ ì‚­ì œí•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ yaml íŒŒì¼ì´ ìœ„ì¹˜í•œ í´ë”ì—ì„œ ì‘ì—…í•©ë‹ˆë‹¤.</p>
<ul>
<li>kubectl delete -f frontend-deployment.yaml</li>
</ul>
</li>
<li><p>ê·¸ë¦¬ê³  frontend-deployment.yaml íŒŒì¼ì„ ìˆ˜ì •í•©ë‹ˆë‹¤. ì´ yamlíŒŒì¼ì—ì„œ ë¯¸ë¦¬ ë“±ë¡í•œ fargate profileì„ ë„£ì–´ì£¼ê² ìŠµë‹ˆë‹¤. labelê°’ì„ frontend-fargateë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤. 1ë²ˆì—ì„œ key ê°’ì´ appì´ê³  value ê°’ì´ frontend-fargateì´ë©° namespaceê°€ defaultì¼ ë•Œ, podë¥¼ fargateë¡œ ë°°í¬í•˜ê² ë‹¤ëŠ” ì¡°ê±´ì„ ë§ì¶”ê¸° ìœ„í•´ ê°’ì„ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/home/ec2-user/environment/manifestscat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-deployment.yaml---apiVersion:</span> <span class="string">apps/v1kind:</span> <span class="attr">Deploymentmetadata:</span>  <span class="attr">name:</span> <span class="string">demo-frontend</span>  <span class="attr">namespace:</span> <span class="attr">defaultspec:</span>  <span class="attr">replicas:</span> <span class="number">3</span>  <span class="attr">selector:</span>    <span class="attr">matchLabels:</span>      <span class="attr">app:</span> <span class="string">frontend-fargate</span>  <span class="attr">template:</span>    <span class="attr">metadata:</span>      <span class="attr">labels:</span>        <span class="attr">app:</span> <span class="string">frontend-fargate</span>    <span class="attr">spec:</span>      <span class="attr">containers:</span>        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo-frontend</span>          <span class="attr">image:</span> <span class="string">$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</span>          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span>          <span class="attr">ports:</span>            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>frontend-service.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-service.yaml---apiVersion:</span> <span class="attr">v1kind:</span> <span class="attr">Servicemetadata:</span>  <span class="attr">name:</span> <span class="string">demo-frontend</span>  <span class="attr">annotations:</span>    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/"</span><span class="attr">spec:</span>  <span class="attr">selector:</span>    <span class="attr">app:</span> <span class="string">frontend-fargate</span>  <span class="attr">type:</span> <span class="string">NodePort</span>  <span class="attr">ports:</span>    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span>      <span class="attr">port:</span> <span class="number">80</span>      <span class="attr">targetPort:</span> <span class="number">80</span><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°°í¬</p>
<p><code>kubectl apply -f frontend-deployment.yaml
kubectl apply -f frontend-service.yaml</code></p>
</li>
<li><p>ë°°í¬ ìƒíƒœ í™•ì¸</p>
<ul>
<li>kubectl get po -o wide</li>
</ul>
</li>
<li><p>ì´ì „ê³¼ ê°™ì€ ìƒíƒœì¸ì§€ ì›¹ í™•ì¸</p>
<ul>
<li>echo <a target="_blank" rel="noopener" href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=â€™{.status.loadBalancer.ingress[*].hostname}â€™)</li>
</ul>
<p><br></br></p>
<h2 id="GitOps"><a href="#GitOps" class="headerlink" title="GitOps?"></a>GitOps?</h2></li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ CI/CDë¥¼ ìœ„í•´ì„œëŠ” Gitê³¼ ì›Œí¬í”Œë¡œìš° íˆ´ì˜ ì—°ê²°ì´ í•„ìš”í•˜ê³ , ì´ë¥¼ í†µí•´ì„œ ìë™í™” í•˜ëŠ” ë°©ì•ˆì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
</li>
<li><p>ì¼ì¼ì´ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ë„ˆë¬´ë‚˜ ë²ˆê±°ë¡­ìŠµë‹ˆë‹¤.</p>
</li>
<li><p>ê·¸ë˜ì„œ ë“±ì¥í•œ ê²ƒì´ GitOpsì…ë‹ˆë‹¤.</p>
</li>
<li><p>Github Action, Kustomize, Helm Chart, Argo CDë¥¼ í™œìš©í•´ GitOpsë¥¼ ì²´í—˜í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<p><br></br></p>
<h2 id="GitOps-ì „ì—-ì•Œì•„ì•¼-í• -ê°œë…ë“¤"><a href="#GitOps-ì „ì—-ì•Œì•„ì•¼-í• -ê°œë…ë“¤" class="headerlink" title="GitOps ì „ì— ì•Œì•„ì•¼ í•  ê°œë…ë“¤"></a>GitOps ì „ì— ì•Œì•„ì•¼ í•  ê°œë…ë“¤</h2></li>
<li><p>ì•ì„œ ì†Œê°œí•œ Kustomizeë‚˜ Argo CDë“±ì€ ì¡°ê¸ˆ ìƒì†Œí•´ ë³´ì…ë‹ˆë‹¤.</p>
</li>
<li><p>ì´í•´ë¥¼ ìœ„í•´ ë¯¸ë¦¬ í•œë²ˆ ì •ë¦¬ë¥¼ í•˜ê³  ë„˜ì–´ê°€ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3 id="Kustomize"><a href="#Kustomize" class="headerlink" title="Kustomize"></a>Kustomize</h3></li>
<li><p>Kubernetesì—ì„œ appì„ ë°°í¬ë¥¼ í• ë•Œ manifest íŒŒì¼ì„ ì‘ì„±í•œë‹¤</p>
</li>
<li><p>staging í™˜ê²½ì— ë°°í¬í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì´ ë°œìƒí•˜ê³ , ìˆ˜ì •ì‚¬í•­ì´ ê³„ì† ë°œìƒí•œë‹¤ë©´, ì‘ì—…ì„ ë°˜ë³µí•´ì•¼ í•˜ëŠ” ì´ìŠˆê°€ ìƒê¸´ë‹¤</p>
</li>
<li><p>ê´€ë¦¬í•´ì•¼í•  manifestíŒŒì¼ì´ 3ë°°ê°€ ë˜ì–´ë²„ë¦¼</p>
</li>
<li><p>ê²¹ì¹˜ëŠ” ë‚´ìš©ì´ ëŒ€ë¶€ë¶„ì¸ë°, ì´ê²ƒì„ baseë¼ê³  í•˜ê³ , í™˜ê²½ë§ˆë‹¤ ì°¨ì´ê°€ ë‚˜ëŠ” ë¶€ë¶„ì„ overlayë¡œ ê´€ë¦¬í•´ë³´ì</p>
</li>
<li><p>kustomizeëŠ” ì´ë ‡ê²Œ, ê³µí†µ ë¶€ë¶„ê³¼ ì°¨ì´ê°€ ë‚˜ëŠ” ë¶€ë¶„ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì—ì„œ ì‹œì‘í•œë‹¤.</p>
</li>
<li><p>baseì™€ overlayë¥¼ ë¨¸ì§€í•˜ë©´ì„œ í™˜ê²½ë§ˆë‹¤ ë‹¤ë¥¸ specì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê²Œ ëœë‹¤.</p>
</li>
<li><p>ê°œë°œ í™˜ê²½ë§ˆë‹¤ ì†ŒìŠ¤ êµ¬ë¶„í•˜ì—¬ configmap, secretìƒì„±ì´ ê°€ëŠ¥í•˜ë‹¤</p>
</li>
<li><p>resourceì´ë¦„ì— prefixë¥¼ ì¶”ê°€í•˜ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•œë‹¤</p>
</li>
<li><p>Kustomizeë¥¼ ì ìš©í•´ì„œ ì§ì ‘ ìˆ˜ë™ìœ¼ë¡œ ë°°í¬í•  ìˆ˜ë„ ìˆë‹¤</p>
<ul>
<li>GitOpsë¡œ ArgoCDë‚˜ Fluxë“±ì„ ì‚¬ìš©í•´ì„œ ë°°í¬ê³¼ì •ì„ ìë™í™” í•œë‹¤.</li>
<li>Flux ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ ì„¤ì • ì†ŒìŠ¤(git..)ì™€ ë™ê¸°í™”ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìƒˆ ì½”ë“œê°€ ì¶”ê°€ë˜ë©´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•´ì£¼ëŠ” ë„êµ¬</li>
</ul>
<p><br></br></p>
<h3 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h3></li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ íŒ¨í‚¤ì§€ ê´€ë¦¬ë¥¼ ë„ì™€ì¤Œ</p>
<ul>
<li>npm, pipì™€ ë¹„ìŠ·í•œ ì—­í• </li>
</ul>
</li>
<li><p>Chart: í—¬ë¦„ íŒ¨í‚¤ì§€</p>
<ul>
<li>kubernetesë¥¼ ì„¤ëª…í•˜ëŠ” íŒŒì¼ë“¤ì˜ ì§‘í•©</li>
<li>kubernetesì—ì„œ appì´ ë™ì‘í•˜ê¸° ìœ„í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë“¤ì´ í¬í•¨ë˜ì–´ ìˆìŒ</li>
</ul>
</li>
<li><p>Repository</p>
<ul>
<li>ì°¨íŠ¸ ì €ì¥ì†Œ, ì°¨íŠ¸ë¥´ ëª¨ì•„ë‘ê³  ê³µìœ í•¨</li>
</ul>
</li>
<li><p>Release</p>
<ul>
<li>kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ êµ¬ë™ë˜ëŠ” ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤</li>
<li>ë™ì¼í•œ ì°¨íŠ¸ë¥¼ ì—¬ëŸ¬ë²ˆ ì„¤ì¹˜í•  ìˆ˜ ìˆê³  ì´ëŠ” ìƒˆ ë¦´ë¦¬ì¦ˆë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.</li>
<li>ë¦´ë¦¬ì¦ˆ ë  ë•Œ íŒ¨í‚¤ì§€ëœ ì°¨íŠ¸ì™€ configê°€ ê²°í•©ë˜ì–´ ì •ìƒ ì‹¤í–‰ ë©ë‹ˆë‹¤</li>
</ul>
</li>
<li><p>ì‘ì—… ìˆœì„œ</p>
<ul>
<li>Helm ì°¨íŠ¸ë¥¼ ì›í•˜ëŠ” ë ˆí¬ì—ì„œ ê²€ìƒ‰ í›„ ì„¤ì¹˜ â†’ ê° ì„¤ì¹˜ì— ë”°ë¥¸ ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆ ìƒì„±</li>
</ul>
<p><br></br></p>
<h3 id="Argo-CD"><a href="#Argo-CD" class="headerlink" title="Argo CD"></a>Argo CD</h3></li>
<li><p>Continuous Delivery</p>
<ul>
<li>ì§€ì†ì  í†µí•©ì„ í†µí•´ í…ŒìŠ¤íŠ¸ ë˜ê³  ë¹Œë“œëœ ì½”ë“œë¥¼ ì§€ì†ì ìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ ì œí’ˆì˜ ì§ˆì  í–¥ìƒì„ í–¥í•˜ëŠ” ê²ƒ</li>
</ul>
</li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ ìš´ì˜ê³¼ ê´€ë ¨ëœ manifest íŒŒì¼ ê´€ë¦¬í•˜ê³  ìˆëŠ” ì›ê²© ë ˆí¬ì§€í† ë¦¬ë¥¼ ì¡°íšŒ</p>
</li>
<li><p>ë³€ê²½ ë‚´ì—­ì´ ê°ì§€ë˜ë©´ ì´ë¥¼ ë°˜ì˜í•˜ì—¬ ë°°í¬í•¨(Auto Sync ì˜µì…˜)</p>
</li>
<li><p>íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•˜ê³ , ë¡¤ë°±ì´ ê°€ëŠ¥í•¨</p>
<p><img src="/images/eks-workshop/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2021-11-03_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.46.28.png" alt="Dev, Ops Pipeline"></p>
</li>
<li><p>argoì˜ ì¥ì </p>
<ul>
<li>ì‹¤í–‰ ë‹¨ìœ„ê°€ ì»¨í…Œì´ë„ˆê¸° ë•Œë¬¸ì— ê³ ë¦½ì„±ì´ ë†’ë‹¤<ul>
<li>ê°œë³„ ì‘ì—…ë§ˆë‹¤ ì‹¤í–‰í™˜ê²½ì´ ë‹¤ì–‘í•œ ê²½ìš° ì‹¤í–‰í™˜ê²½ì´ ì„ì´ì§€ ì•Šê³  ë‹¨ë…ì ì¸ í™˜ê²½ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.</li>
<li>í•˜ë‚˜ì˜ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” Jobì„ ë‹¨ì¼í•˜ê²Œ ê°œë°œí•  ìˆ˜ ìˆì–´ ì¬ì‚¬ìš©ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.<ul>
<li>ë°ì´í„° ì…ì¶œë§Œ ì˜ ë§ì¶° ë†“ìœ¼ë©´ ë‹¨ì¼ ì—­í• ì„ í•˜ëŠ” Jobì„ ì—¬ëŸ¬ê°œ ë§Œë“¤ê³ , ë¸”ë¡ì²˜ëŸ¼ ìŒ“ì„ ìˆ˜ ìˆë‹¤.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>argoì˜ ë‹¨ì </p>
<ul>
<li>Podë¥¼ ìƒì„±í•˜ê³  ì‚­ì œí•˜ëŠ” ë¹„ìš©ì´ í¬ë‹¤.<ul>
<li>ê°„ë‹¨í•œ ì‘ì—…ì´ë¼ë©´ í”„ë¡œì„¸ìŠ¤ ë˜ëŠ” ìŠ¤ë ˆë“œ ë ˆë²¨ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²Œ íš¨ìœ¨ì ì¼ ë•Œê°€ ìˆë‹¤</li>
</ul>
</li>
<li>ê° ìŠ¤í…ë§ˆë‹¤ ê°œë³„ì ì¸ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•´ì„œ Jobê°„ì— ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ê³µìœ í•˜ëŠ” ê²ƒì´ í˜ë“¤ë‹¤.<ul>
<li>Pod ë‚´ë¶€ ì»¨í…Œì´ë„ˆ ê°„ì—ë§Œ volumeê³µìœ ê°€ ê°€ëŠ¥í•˜ë‹¤</li>
</ul>
</li>
</ul>
</li>
<li><p>ë°ì´í„° íŒŒì´í”„ë¼ì¸ ë° ê¸°ê³„í•™ìŠµ ëª¨ë¸ í›ˆë ¨ì— í™œìš© ê°€ëŠ¥</p>
<ul>
<li>ë°ì´í„° íƒ€ì…ì— ë”°ë¼ ì¶”ì¶œí•˜ëŠ” ì†ŒìŠ¤ì— ë”°ë¼ ìƒì´í•œ ì‹¤í–‰í™˜ê²½<ul>
<li>ë°ì´í„° ì¶”ì¶œ - Apache sqoop(Java runtime, hadoop ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš”)<ul>
<li>S3 - aws cli, boto3â€¦</li>
</ul>
</li>
<li>ML<ul>
<li>python</li>
<li>R</li>
</ul>
</li>
</ul>
</li>
<li>ê³ ë¦½ì„±ì´ êµ‰ì¥íˆ ì¢‹ê¸° ë•Œë¬¸ì— MLì›Œí¬í”Œë¡œìš° íˆ´ë¡œë„ í™œìš©ì´ ê°€ëŠ¥í•¨</li>
</ul>
<p><br></br></p>
<h2 id="GitOps-ì‹¤ìŠµ"><a href="#GitOps-ì‹¤ìŠµ" class="headerlink" title="GitOps ì‹¤ìŠµ"></a>GitOps ì‹¤ìŠµ</h2></li>
<li><p>ëª©í‘œí•˜ëŠ” CI/CD íŒŒì´í”„ë¼ì¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<img src="/images/eks-workshop/Untitled 8.png" alt="CI/CD" style="zoom:50%;" />
</li>
<li><p>ê°œë°œì—ì„œ ì‘ì—…í•œ ë‚´ìš©ì€ Github Actionì„ í†µí•´ ECRì— ì—…ë¡œë“œ ë˜ê³ , ì´ê²ƒì„ í´ëŸ¬ìŠ¤í„° Opsìª½ì—ì„œ Pullì„ ë°›ì•„ k8sì— argo CDë¥¼ ì‚¬ìš©í•´ ë°°í¬í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>
</li>
<li><p>í•„ìš”í•œ ë ˆí¬ëŠ” ë‘ ê°€ì§€ ì…ë‹ˆë‹¤. applicationìš©ê³¼ k8s ë©”ë‹ˆí˜ìŠ¤íŠ¸ ê´€ë¦¬ìš© ë ˆí¬ì…ë‹ˆë‹¤.</p>
<ul>
<li><strong><em>front-app-repo</em></strong>: Frontend ì†ŒìŠ¤ê°€ ìœ„ì¹˜í•œ ë ˆíŒŒì§€í† ë¦¬</li>
<li><strong><em>k8s-manifest-repo</em></strong>: K8S ê´€ë ¨ ë©”ë‹ˆí˜ìŠ¤íŠ¸ê°€ ìœ„ì¹˜í•œ ë ˆíŒŒì§€í† ë¦¬</li>
</ul>
</li>
<li><p>git remoteë¥¼ ìœ„í•´ì„œ cloud9ì— ìˆëŠ” amazon-eks-frontend ë””ë ‰í† ë¦¬ gitì„ ì´ˆê¸°í™” í•©ë‹ˆë‹¤.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>rm -rf .git</li>
<li>ì†ŒìŠ¤ íŒŒì¼ë“¤ì„ í‘¸ì‹œí•©ë‹ˆë‹¤.<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git init<br>git add .<br>git commit -m â€œfirst commitâ€<br>git branch -M main<br>git remote add origin <a target="_blank" rel="noopener" href="https://github.com/jinseo-jang/front-app-repo.git">https://github.com/jinseo-jang/front-app-repo.git</a><br>git push -u origin main</li>
</ul>
</li>
</ul>
</li>
<li><p>CI/CD íŒŒì´í”„ë¼ì¸ì„ ìœ„í•´ì„œëŠ” ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<ul>
<li><p>front appì„ ë¹Œë“œí•˜ê³  docker imageë¡œ ë§Œë“¤ì–´ì§€ë©´, ì´ê²ƒì„ ECRë¡œ í‘¸ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.</p>
</li>
<li><p>ì´ ê³¼ì •ì€ github Actionìœ¼ë¡œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ìµœì†Œí•œì˜ ê¶Œí•œì„ ë„£ì–´ì¤ë‹ˆë‹¤.</p>
<ul>
<li><p>IAM  user ìƒì„±</p>
<ul>
<li>aws iam create-user â€“user-name github-action</li>
</ul>
</li>
<li><p>ECR policy ìƒì„±</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environmentcat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ecr-policy.json&#123;</span>    <span class="string">"Version"</span><span class="string">:</span> <span class="string">"2012-10-17"</span><span class="string">,</span>    <span class="string">"Statement"</span><span class="string">:</span> <span class="string">[</span>        <span class="string">&#123;</span>            <span class="string">"Sid"</span><span class="string">:</span> <span class="string">"AllowPush"</span><span class="string">,</span>            <span class="string">"Effect"</span><span class="string">:</span> <span class="string">"Allow"</span><span class="string">,</span>            <span class="string">"Action"</span><span class="string">:</span> <span class="string">[</span>                <span class="string">"ecr:GetDownloadUrlForLayer"</span><span class="string">,</span>                <span class="string">"ecr:BatchGetImage"</span><span class="string">,</span>                <span class="string">"ecr:BatchCheckLayerAvailability"</span><span class="string">,</span>                <span class="string">"ecr:PutImage"</span><span class="string">,</span>                <span class="string">"ecr:InitiateLayerUpload"</span><span class="string">,</span>                <span class="string">"ecr:UploadLayerPart"</span><span class="string">,</span>                <span class="string">"ecr:CompleteLayerUpload"</span>            <span class="string">],</span>            <span class="string">"Resource"</span><span class="string">:</span> <span class="string">"arn:aws:ecr:ap-northeast-2:$&#123;ACCOUNT_ID&#125;:repository/demo-frontend"</span>        <span class="string">&#125;,</span>        <span class="string">&#123;</span>            <span class="string">"Sid"</span><span class="string">:</span> <span class="string">"GetAuthorizationToken"</span><span class="string">,</span>            <span class="string">"Effect"</span><span class="string">:</span> <span class="string">"Allow"</span><span class="string">,</span>            <span class="string">"Action"</span><span class="string">:</span> <span class="string">[</span>                <span class="string">"ecr:GetAuthorizationToken"</span>            <span class="string">],</span>            <span class="string">"Resource"</span><span class="string">:</span> <span class="string">"*"</span>        <span class="string">&#125;</span>    <span class="string">]&#125;EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>ì´ íŒŒì¼ì„ ì‚¬ìš©í•´ IAM ì •ì±…ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¦„ì€ <code>ecr-policy</code> ì…ë‹ˆë‹¤.</p>
<ul>
<li>aws iam create-policy â€“policy-name ecr-policy â€“policy-document file://ecr-policy.json</li>
</ul>
</li>
<li><p>ë§Œë“  ì •ì±…ì„ IAM ìœ ì €ì—ê²Œ ë„£ì–´ì¤ë‹ˆë‹¤.</p>
<ul>
<li>aws iam attach-user-policy â€“user-name github-action â€“policy-arn arn:aws:iam::${ACCOUNT_ID}:policy/ecr-policy</li>
</ul>
</li>
</ul>
</li>
<li><p>Github Secret ìƒì„±</p>
<ul>
<li>ì´ì œ github actionì—ì„œ ì‚¬ìš©í•  AWS credential, github tokenì„ ì„¤ì •í•´ì¤ë‹ˆë‹¤.</li>
<li>AWS credential ìƒì„±<ul>
<li>ì´ ë˜í•œ ìµœì†Œí•œì˜ ê¶Œí•œì„ ê°–ëŠ” ìœ ì €ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ì´ë¦„ì€ <code>github-action</code>ì…ë‹ˆë‹¤.</li>
<li>aws iam create-access-key â€“user-name github-action</li>
<li>ìƒì„±ëœ accesskeyì™€ secretkeyë¥¼ ì €ì¥í•´ë†“ìŠµë‹ˆë‹¤.</li>
</ul>
</li>
<li>Githubìœ¼ë¡œ ë“¤ì–´ê°€ì„œ PATë¥¼ ìƒì„±í•´ì£¼ê³  ì €ì¥í•´ë†“ìŠµë‹ˆë‹¤.</li>
<li>front-app-repoë¡œ ë“¤ì–´ê°€ Settingsì— Secretì„ ì„ íƒí•©ë‹ˆë‹¤.<ul>
<li>ì´ ë ˆí¬ì˜ secretì„ ë„£ì–´ì¤ë‹ˆë‹¤.</li>
<li>Nameì€ <code>ACTION_TOKEN</code></li>
<li>ValueëŠ” PATë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.</li>
<li>ë§ˆì°¬ê°€ì§€ë¡œ <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code> ë„ ë„£ì–´ì¤ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
</li>
<li><p>Github Actionì„ ìœ„í•œ workflow ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
<ul>
<li><p>github actionì„ ìƒì„±í•˜ë©´ .github/workflowsì— ë§Œë“¤ì–´ì§€ê¸° ë•Œë¬¸ì— ê°™ì€ ë””ë ‰í† ë¦¬ë¥¼ ë¨¼ì € ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>mkdir -p ./.github/workflows</li>
</ul>
</li>
<li><p>ì‹¤ì œ build ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. <code>build.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/amazon-eks-frontend/.github/workflowscat</span> <span class="string">&gt; build.yaml &lt;&lt;EOFname: Build Fronton:  push:    branches: [ main ]jobs:  build:    runs-on: ubuntu-latest    steps:      - name: Checkout source code        uses: actions/checkout@v2      - name: Check Node v        run: node -v      - name: Build front        run: |          npm install          npm run build      - name: Configure AWS credentials        uses: aws-actions/configure-aws-credentials@v1        with:          aws-access-key-id: \$<span class="template-variable">&#123;&#123; secrets.AWS_ACCESS_KEY_ID &#125;&#125;</span>          aws-secret-access-key: \$<span class="template-variable">&#123;&#123; secrets.AWS_SECRET_ACCESS_KEY &#125;&#125;</span>          aws-region: $AWS_REGION      - name: Login to Amazon ECR        id: login-ecr        uses: aws-actions/amazon-ecr-login@v1      - name: Get image tag(verion)        id: image        run: |          VERSION=\$(echo \$<span class="template-variable">&#123;&#123; github.sha &#125;&#125;</span> | cut -c1-8)          echo VERSION=\$VERSION          echo "::set-output name=version::\$VERSION"      - name: Build, tag, and push image to Amazon ECR        id: image-info        env:          ECR_REGISTRY: \$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry &#125;&#125;</span>          ECR_REPOSITORY: demo-frontend          IMAGE_TAG: \$<span class="template-variable">&#123;&#123; steps.image.outputs.version &#125;&#125;</span>        run: |          echo "::set-output name=ecr_repository::\$ECR_REPOSITORY"          echo "::set-output name=image_tag::\$IMAGE_TAG"          docker build -t \$ECR_REGISTRY/\$ECR_REPOSITORY:\$IMAGE_TAG .          docker push \$ECR_REGISTRY/\$ECR_REPOSITORY:\$IMAGE_TAGEOF</span></span><br></pre></td></tr></table></figure>

<ul>
<li>IMAGE_TAGê°’ì€ ëœë¤ìœ¼ë¡œ ìƒì„±ë˜ì–´ ECRë¡œ Pushë©ë‹ˆë‹¤.<ul>
<li>$</li>
</ul>
</li>
</ul>
</li>
<li><p>github actionì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•©ë‹ˆë‹¤.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git add .<br>git commit -m â€œAdd github action build scriptâ€<br>git push origin main</li>
<li></li>
</ul>
</li>
</ul>
</li>
<li><p>Kustomize ì‚¬ìš©ì„ ìœ„í•œ k8s manifest êµ¬ì¡°í™”</p>
<ul>
<li><p>ì•ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ, kustomizeëŠ” manifestë¥¼ baseì™€ overlaysë¡œ ë‚˜ë‰˜ì–´ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
</li>
<li><p>ì´ êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environmentmkdir</span> <span class="bullet">-p</span> <span class="string">./k8s-manifest-repo/basemkdir</span> <span class="bullet">-p</span> <span class="string">./k8s-manifest-repo/overlays/devcd</span> <span class="string">~/environment/manifestscp</span> <span class="string">*.yaml</span> <span class="string">../k8s-manifest-repo/basecd</span> <span class="string">../k8s-manifest-repo/basels</span> <span class="bullet">-rlt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><em><code>base</code></em> : kubernetes manifest ì›ë³¸ì´ ìœ„ì¹˜í•œ ë””ë ‰í† ë¦¬ ì…ë‹ˆë‹¤. ì´ ì•ˆì— ìœ„ì¹˜í•œ manifest ë“¤ì€ <em><code>overlays</code></em> ì•„ë˜ì— ìœ„ì¹˜í•œ <strong>kustomize.yaml</strong> íŒŒì¼ì— ë‹´ê¸´ <strong>ì‚¬ìš©ì ì§€ì • ì„¤ì •</strong> ë‚´ìš©ì— ë”°ë¼ ë³€ê²½ë©ë‹ˆë‹¤.</p>
</li>
<li><p><em><code>overlays</code></em> : <strong>ì‚¬ìš©ì ì…ë§›ì— ë§ëŠ”</strong> ì„¤ì • ê°’ì´ ìœ„ì¹˜í•œ ë””ë ‰í† ë¦¬ ì…ë‹ˆë‹¤. ì´ ì„¤ì •ì€ <strong>kustomize.yaml</strong> ì— ë‹´ìŠµë‹ˆë‹¤. ì´ í•˜ìœ„ì— ìˆëŠ” <em><code>dev</code></em> ë””ë ‰í† ë¦¬ëŠ” ì‹¤ìŠµì„ ìœ„í•´ ë§Œë“  ê²ƒìœ¼ë¡œ, ê°œë°œ í™˜ê²½ì— ì ìš©í•  ì„¤ì • íŒŒì¼ì„ ëª¨ì•„ ë‘ê¸° ìœ„í•¨ ì…ë‹ˆë‹¤.</p>
</li>
</ul>
</li>
<li><p>Kustomize manifest ìƒì„±</p>
<ul>
<li><p>frontend appì— ëŒ€í•œ ë°°í¬ êµ¬ì„±ì„ í•  ê²ƒì´ê¸° ë•Œë¬¸ì— frontendë¶€ë¶„ë§Œ ì‘ì—… í•˜ê² ìŠµë‹ˆë‹¤.</p>
<ul>
<li>frontend-deployment.yaml ê³¼ frontend-service.yaml íŒŒì¼ì„ kustomize ë¥¼ í†µí•´ ë°°í¬ ì‹œì ì— ì˜ë„í•œ ê°’(e.g. Image Tag)ì„ ë°˜ì˜ í• ê²ë‹ˆë‹¤</li>
<li>ë°˜ì˜ë  ê°’<ul>
<li><strong><code>metadata.labels</code>:</strong> <code>&quot;env: dev&quot;</code>ì„ frontend-deployment.yaml, frontend-service.yaml ì— ì¼ê´„ ë°˜ì˜ í•©ë‹ˆë‹¤.</li>
<li><strong><code>spec.selector</code></strong> : <code>&quot;select.app: frontend-fargate&quot;</code> ë¥¼ frontend-deployment.yaml, frontend-service.yaml ì— ì¼ê´„ ë°˜ì˜ í•©ë‹ˆë‹¤.</li>
<li><strong><code>spec.template.spec.containers.image</code></strong> : <code>&quot;image: &quot;</code> ê°’ì„ ìƒˆë¡­ê²Œ ë³€ê²½ëœ Image Tag ì •ë³´ë¡œ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
</li>
<li><p>kustomize.yaml íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ê´€ë¦¬ ë³€ê²½í•  manifestëŒ€ìƒì„ ì •ì˜í•©ë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/base</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">kustomization.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kustomize.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Kustomization</span></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">frontend-deployment.yaml</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">frontend-service.yaml</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>overlays/dev ë¶€ë¶„ì— ë°”ê¿€ ë¶€ë¶„ì„ ì •ì˜í•©ë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/overlays/dev</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">front-deployment-patch.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    env:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">frontend-fargate</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">frontend-fargate</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/overlays/devcat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">front-service-patch.yamlapiVersion:</span> <span class="attr">v1kind:</span> <span class="attr">Servicemetadata:</span>  <span class="attr">name:</span> <span class="string">demo-frontend</span>  <span class="attr">annotations:</span>    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/"</span>  <span class="attr">labels:</span>    <span class="attr">env:</span> <span class="attr">devspec:</span>  <span class="attr">selector:</span>    <span class="attr">app:</span> <span class="string">frontend-fargateEOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ìœ„ì—ì„œ ì„¤ì • í•œ íŒŒì¼ë“¤(ê°’)ì„ ì‚¬ìš©í•˜ê³  frontend app ë¹Œë“œì— ë”°ë¼ ë§Œë“¤ì–´ì§„ ìƒˆë¡œìš´ <strong>Image Tag</strong> ë¥¼ ì‚¬ìš© í•˜ê² ë‹¤ê³  ì •ì˜ í•˜ê² ìŠµë‹ˆë‹¤. êµ¬ì²´ì ìœ¼ë¡œëŠ”, <code>name</code> ì— ì§€ì •ëœ imageëŠ” <code>newName</code>ì˜ imageì™€ <code>newTag</code>ì˜ ê°’ìœ¼ë¡œ ì‚¬ìš© í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ ì…ë‹ˆë‹¤.</p>
</li>
<li><p>ì´ë¥¼ í™œìš©í•´ <code>newTag</code> ê°’ì„ ë³€ê²½í•´ ìƒˆë¡œìš´ ë°°í¬ê°€ ì´ë£¨ì–´ì§ˆ ë•Œ ë§ˆë‹¤ ì´ë¥¼ kubernetes í´ëŸ¬ìŠ¤í„°ê¹Œì§€ ë³€ê²½ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/overlays/devcat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">kustomization.yamlapiVersion:</span> <span class="string">kustomize.config.k8s.io/v1beta1kind:</span> <span class="attr">Kustomizationimages:-</span> <span class="attr">name:</span> <span class="string">$&#123;ACCOUNT_ID&#125;.dkr.ecr.ap-northeast-2.amazonaws.com/demo-frontend</span>  <span class="attr">newName:</span> <span class="string">$&#123;ACCOUNT_ID&#125;.dkr.ecr.ap-northeast-2.amazonaws.com/demo-frontend</span>  <span class="attr">newTag:</span> <span class="attr">abcdefgresources:-</span> <span class="string">../../basepatchesStrategicMerge:-</span> <span class="string">front-deployment-patch.yaml-</span> <span class="string">front-service-patch.yamlEOF</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ì´ìƒ -patch.yaml íŒŒì¼ì— ì •ì˜í•œ ë‚´ìš©ë“¤ì€ ë°°í¬ ê³¼ì •ì—ì„œ kustomize ì— ì˜í•´ ìë™ìœ¼ë¡œ kubernetes manifest ì— ë°˜ì˜ ë©ë‹ˆë‹¤.</li>
<li>ì´ë¯¸ì§€ì˜ íƒœê·¸ëª…ì´ abcdefgë¡œ ë‚˜ì˜¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.</li>
</ul>
</li>
<li><p>kubernetes manifest ìš© github repoë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
<ul>
<li>k8s-manifefst-repo <strong>**</strong>ìƒì„±</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/git</span> <span class="string">initgit</span> <span class="string">add</span> <span class="string">.git</span> <span class="string">commit</span> <span class="bullet">-m</span> <span class="string">"first commit"</span><span class="string">git</span> <span class="string">branch</span> <span class="bullet">-M</span> <span class="string">maingit</span> <span class="string">remote</span> <span class="string">add</span> <span class="string">origin</span> <span class="attr">https://github.com/jinseo-jang/k8s-manifest-repo.gitgit</span> <span class="string">push</span> <span class="bullet">-u</span> <span class="string">origin</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Argo CD ì„¤ì¹˜</p>
<ul>
<li>kubectl create namespace argocd<br>kubectl apply -n argocd -f <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml">https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</a></li>
</ul>
</li>
<li><p>Argo CD cli ì„¤ì¹˜</p>
<ul>
<li>cd ~/environment<br>VERSION=$(curl â€“silent â€œ<a target="_blank" rel="noopener" href="https://api.github.com/repos/argoproj/argo-cd/releases/latest">https://api.github.com/repos/argoproj/argo-cd/releases/latest</a>â€œ | grep â€˜â€œtag_nameâ€â€˜ | sed -E â€˜s/.*â€([^â€]+)â€.*/\1/â€˜)</li>
<li>sudo curl â€“silent â€“location -o /usr/local/bin/argocd <a target="_blank" rel="noopener" href="https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64">https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64</a></li>
<li>sudo chmod +x /usr/local/bin/argocd</li>
</ul>
</li>
<li><p>Argo CDëŠ” í¼ë¸”ë¦­í•˜ê²Œ ë…¸ì¶œë˜ì§€ ì•Šì§€ë§Œ, ELBë¥¼ í†µí•´ ì ‘ì† ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.</p>
<ul>
<li>kubectl patch svc argocd-server -n argocd -p â€˜{â€œspecâ€: {â€œtypeâ€: â€œLoadBalancerâ€}}â€™</li>
</ul>
</li>
<li><p>ì ‘ì†í•  urië¥¼ ì–»ìŠµë‹ˆë‹¤.</p>
<ul>
<li>export ARGOCD_SERVER=<code>kubectl get svc argocd-server -n argocd -o json | jq --raw-output .status.loadBalancer.ingress[0].hostname</code><br>echo $ARGOCD_SERVER</li>
</ul>
</li>
<li><p>ê¸°ë³¸ usernameì€ adminì…ë‹ˆë‹¤. passwordëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<ul>
<li>ARGO_PWD=<code>kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=&quot;{.data.password}&quot; | base64 -d</code><br>echo $ARGO_PWD</li>
</ul>
</li>
<li><p>argo login</p>
<img src="/images/eks-workshop/Untitled 9.png" alt="loginí™”ë©´" style="zoom:60%;" />
</li>
<li><p>ë¡œê·¸ì¸ í›„ ì¢Œ ìƒë‹¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ë©”ë‰´ë¥¼ í´ë¦­í•˜ê³  ìƒˆ applicationì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
</li>
<li><p><strong>Application Name</strong> ì€ <code>eksworkshop-cd-pipeline</code>, <strong>Project</strong>ëŠ” <code>default</code>ë¥¼ ì…ë ¥ í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>SOURCE</strong> ì„¹ì…˜ì˜ <strong>Repository URL</strong> ì—ëŠ” ì•ì„œ ìƒì„±í•œ <strong><code>k8s-manifest-repo</code>ì˜ git ì£¼ì†Œ</strong>, <strong>Revision</strong> ì—ëŠ” <code>main</code>, <strong>Path</strong> ì—ëŠ” <code>overlays/dev</code>ë¥¼ ì…ë ¥ í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>DESTINATION</strong> ì„¹ì…˜ì˜ <strong>Cluster URL</strong>ì—ëŠ” <code>https://kubernetes.default.svc</code>, <strong>Namespace</strong> ì—ëŠ” <code>default</code>ë¥¼ ì…ë ¥ í•˜ê³  ìƒë‹¨ì˜ <strong>Create</strong> ë¥¼ í´ë¦­ í•©ë‹ˆë‹¤.</p>
</li>
<li><p>eksworkshop-cd-pipelineì´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.</p>
</li>
<li><p>Kustomize ë¹Œë“œ ë‹¨ê³„ ì¶”ê°€</p>
<ul>
<li>github actionì—ì„œ kustomizeë¥¼ ì´ìš©í•˜ì—¬ image tagë¥¼ ì—…ë°ì´íŠ¸ í•œ í›„ k8s-manifest-repoì— ì»¤ë°‹ í‘¸ì‹œí•˜ëŠ” ë‹¨ê³„ë¥¼ ì¶”ê°€ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.</li>
<li>ì´ ë‹¨ê³„ê°€ ë™ì‘í•˜ë©´, argo CDê°€ k8s-manifest-repoë¥¼ ì„¼ì‹± í•˜ë‹¤ê°€ ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ ê°ì§€ë˜ë©´ Kustomize build ì‘ì—…ì„ ìˆ˜í–‰í•´ ìƒˆë¡œìš´ kubernetes manifestë¥¼ eksí´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•©ë‹ˆë‹¤.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/amazon-eks-frontend/.github/workflows</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;&gt;</span> <span class="string">build.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">Setup</span> <span class="string">Kustomize</span></span><br><span class="line"><span class="attr">        uses:</span> <span class="string">imranismail/setup-kustomize@v1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">Checkout</span> <span class="string">kustomize</span> <span class="string">repository</span></span><br><span class="line"><span class="attr">        uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"><span class="attr">        with:</span></span><br><span class="line"><span class="attr">          repository:</span> <span class="string">jinseo-jang/k8s-manifest-repo</span></span><br><span class="line"><span class="attr">          ref:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">          token:</span> <span class="string">\$&#123;&#123;</span> <span class="string">secrets.ACTION_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">k8s-manifest-repo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">Update</span> <span class="string">Kubernetes</span> <span class="string">resources</span></span><br><span class="line"><span class="attr">        run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo \$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry &#125;&#125;</span></span></span><br><span class="line"><span class="string">          echo \$<span class="template-variable">&#123;&#123; steps.image-info.outputs.ecr_repository &#125;&#125;</span></span></span><br><span class="line"><span class="string">          echo \$<span class="template-variable">&#123;&#123; steps.image-info.outputs.image_tag &#125;&#125;</span></span></span><br><span class="line"><span class="string">          cd k8s-manifest-repo/overlays/dev/</span></span><br><span class="line"><span class="string">          kustomize edit set image \$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry&#125;&#125;</span>/\$<span class="template-variable">&#123;&#123; steps.image-info.outputs.ecr_repository &#125;&#125;</span>=\$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry&#125;&#125;</span>/\$<span class="template-variable">&#123;&#123; steps.image-info.outputs.ecr_repository &#125;&#125;</span>:\$<span class="template-variable">&#123;&#123; steps.image-info.outputs.image_tag &#125;&#125;</span></span></span><br><span class="line"><span class="string">          cat kustomization.yaml</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span><span class="attr">      - name:</span> <span class="string">Commit</span> <span class="string">files</span></span><br><span class="line"><span class="attr">        run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          cd k8s-manifest-repo</span></span><br><span class="line"><span class="string">          git config --global user.email "github-actions@github.com"</span></span><br><span class="line"><span class="string">          git config --global user.name "github-actions"</span></span><br><span class="line"><span class="string">          git commit -am "Update image tag"</span></span><br><span class="line"><span class="string">          git push -u origin main</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ì†ŒìŠ¤ë¥¼ ë§Œë“¤ì—ˆìœ¼ë©´, ì»¤ë°‹ í‘¸ì‹œ í•´ì¤ë‹ˆë‹¤.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git add .<br>git commit -m â€œAdd kustomize image editâ€<br>git push -u origin main</li>
</ul>
</li>
<li><p>github actionì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•˜ê³ , k8s-manifest-repoì— ìƒˆ manifestê°€ ì»¤ë°‹ ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
</li>
<li><p>ì´ë ‡ê²Œ ìƒˆ manifestê°€ ë°°í¬ë˜ë©´, argo CDì—ì„œ ê°ì§€í•˜ì—¬, Sync Statusê°€ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤.</p>
<ul>
<li>ì•„ë¬´ ì„¤ì •ì„ í•˜ì§€ ì•Šì•˜ë‹¤ë©´, <strong>CURRENT SYNC STATUS</strong>ì˜ ê°’ì´ <strong>Out of Synced</strong> ì…ë‹ˆë‹¤.</li>
<li>git repository ê°€ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ sync ì‘ì—…ì´ ìˆ˜í–‰ í•˜ë„ë¡ í•˜ë ¤ë©´ <strong>Auto-Sync</strong> ë¥¼ í™œì„±í™” í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ <strong>APP DETAILS</strong> ë¡œ ì´ë™ í•˜ì—¬ <strong>ENABLE AUTO-SYNC</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ í™œì„±í™” í•©ë‹ˆë‹¤.</li>
<li>í™œì„±í™” ë˜ì—ˆë‹¤ë©´, ArgoCDì— ì˜í•´ k8s-manifest-repoì˜ ì»¤ë°‹ ë‚´ìš©ì´ ArgoCDì— ì˜í•´ eksí´ëŸ¬ìŠ¤í„°ì— ë°˜ì˜ë©ë‹ˆë‹¤.</li>
<li>ë§ˆì§€ë§‰ìœ¼ë¡œ ì •ìƒì ìœ¼ë¡œ ìƒˆ manifestê°€ ë°°í¬ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ k8s-manifest-repoì˜ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ í†µí•´ image tagë¥¼ ì‚´í´ë´…ë‹ˆë‹¤.</li>
<li>abcdefgê°€ ì•„ë‹ˆë¼ ìƒˆë¡œìš´ íƒœê·¸ê°’ìœ¼ë¡œ ë“¤ì–´ê°”ë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.</li>
</ul>
</li>
<li><p>frontend applicationì— ì½”ë“œë¥¼ ë³€ê²½í•´ì„œ, GitOps íŒŒì´í”„ë¼ì¸ì´ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ë¥¼ ìµœì¢… ì ê²€í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>amazon-eks-frontend/src/</strong> ë¡œ ì´ë™í•˜ì—¬ <strong><code>App.js</code></strong> ë”ë¸” í´ë¦­í•˜ì—¬ íŒŒì¼ì„ ì˜¤í”ˆ í•©ë‹ˆë‹¤.</p>
<ul>
<li><p><strong>line 67</strong>ì˜ ê°’ì„ <strong><code>EKS DEMO Blog version Hyuby</code></strong> ë¡œ ë³€ê²½ í•˜ê³  ì €ì¥ í•©ë‹ˆë‹¤. ì €ì¥ì€ <strong>ctrl+s</strong> ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.</p>
</li>
<li><p>ë³€ê²½ëœ ì†ŒìŠ¤ë¥¼ ì»¤ë°‹ í‘¸ì‹œ í•©ë‹ˆë‹¤.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git add .<br>git commit -m â€œAdd new blog versionâ€<br>git push -u origin main</li>
</ul>
</li>
<li><p>Syncì‘ì—…ì´ ëª¨ë‘ ëë‚˜ë©´, urlë¡œ ì ‘ì†í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
<ul>
<li>echo <a target="_blank" rel="noopener" href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=â€™{.status.loadBalancer.ingress[*].hostname}â€™)</li>
<li>ì§ !</li>
</ul>
<p><img src="/images/eks-workshop/demo_hyuby.png" alt="ì •ìƒë™ì‘ í™•ì¸!"></p>
</li>
</ul>
<p><br></br></p>
</li>
</ul>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a target="_blank" rel="noopener" href="https://daddyprogrammer.org/post/14102/argocd-kubernetes-cluster-deploy/">https://daddyprogrammer.org/post/14102/argocd-kubernetes-cluster-deploy/</a></li>
<li><a target="_blank" rel="noopener" href="https://junghyeonsu.tistory.com/65">https://junghyeonsu.tistory.com/65</a></li>
<li><a target="_blank" rel="noopener" href="https://wookiist.dev/159">https://wookiist.dev/159</a></li>
<li><a target="_blank" rel="noopener" href="https://cwal.tistory.com/23">https://cwal.tistory.com/23</a></li>
<li>[<a target="_blank" rel="noopener" href="https://coffeewhale.com/kubernetes/workflow/argo/2020/02/14/argo-wf/]">https://coffeewhale.com/kubernetes/workflow/argo/2020/02/14/argo-wf/]</a>(</li>
</ul>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/k8s/">k8s</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/11/18/Moving/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ì´ì§ì˜ ê³¼ì •, ê·¸ë¦¬ê³  ì–»ì€ ê²ƒ</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/10/07/docker-hub-limit/"><span class="level-item">Docker hub pull limitì´ ë°œìƒí–ˆë‹¤ë©´?</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-3-tablet is-3-desktop is-3-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Kubernetes-k8s"><span class="level-left"><span class="level-item">1</span><span class="level-item">Kubernetes(k8s)</span></span></a></li><li><a class="level is-mobile" href="#Kubernetes-Objects"><span class="level-left"><span class="level-item">2</span><span class="level-item">Kubernetes Objects</span></span></a></li><li><a class="level is-mobile" href="#EKS"><span class="level-left"><span class="level-item">3</span><span class="level-item">EKS</span></span></a></li><li><a class="level is-mobile" href="#Cloud9"><span class="level-left"><span class="level-item">4</span><span class="level-item">Cloud9</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#kubectl"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">kubectl</span></span></a></li><li><a class="level is-mobile" href="#eksctl"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">eksctl</span></span></a></li><li><a class="level is-mobile" href="#eksctlë¡œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±í•˜ê¸°"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">eksctlë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„±í•˜ê¸°</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Ingress-Controller"><span class="level-left"><span class="level-item">5</span><span class="level-item">Ingress Controller</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#AWS-Load-Balancer-ë§Œë“¤ê¸°"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">AWS Load Balancer ë§Œë“¤ê¸°</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ì„œë¹„ìŠ¤-ë°°í¬"><span class="level-left"><span class="level-item">6</span><span class="level-item">ì„œë¹„ìŠ¤ ë°°í¬</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Flask-ë°°í¬"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">Flask ë°°í¬</span></span></a></li><li><a class="level is-mobile" href="#node-js-ë°°í¬"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">node.js ë°°í¬</span></span></a></li><li><a class="level is-mobile" href="#í”„ë¡ íŠ¸ì—”ë“œ-ë°°í¬"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Fargate"><span class="level-left"><span class="level-item">7</span><span class="level-item">Fargate</span></span></a></li><li><a class="level is-mobile" href="#GitOps"><span class="level-left"><span class="level-item">8</span><span class="level-item">GitOps?</span></span></a></li><li><a class="level is-mobile" href="#GitOps-ì „ì—-ì•Œì•„ì•¼-í• -ê°œë…ë“¤"><span class="level-left"><span class="level-item">9</span><span class="level-item">GitOps ì „ì— ì•Œì•„ì•¼ í•  ê°œë…ë“¤</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Kustomize"><span class="level-left"><span class="level-item">9.1</span><span class="level-item">Kustomize</span></span></a></li><li><a class="level is-mobile" href="#Helm"><span class="level-left"><span class="level-item">9.2</span><span class="level-item">Helm</span></span></a></li><li><a class="level is-mobile" href="#Argo-CD"><span class="level-left"><span class="level-item">9.3</span><span class="level-item">Argo CD</span></span></a></li></ul></li><li><a class="level is-mobile" href="#GitOps-ì‹¤ìŠµ"><span class="level-left"><span class="level-item">10</span><span class="level-item">GitOps ì‹¤ìŠµ</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Reference"><span class="level-left"><span class="level-item">10.1</span><span class="level-item">Reference</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Unreasonable Effectiveness</a><p class="is-size-7"><span>&copy; 2023 SangHyub Lee, Jose</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/main.js" defer></script><!--!--></body></html>