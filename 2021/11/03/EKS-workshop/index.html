<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>EKS-workshop - Unreasonable Effectiveness</title>


    <meta name="description" content="EKS를 다뤄보고 GitOps까지 실습해봤습니다.">
<meta property="og:type" content="article">
<meta property="og:title" content="EKS-workshop">
<meta property="og:url" content="http://tkdguq05.github.io/2021/11/03/EKS-workshop/index.html">
<meta property="og:site_name" content="Unreasonable Effectiveness">
<meta property="og:description" content="EKS를 다뤄보고 GitOps까지 실습해봤습니다.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://coffeewhale.com/assets/images/k8s-cluster/landing02.png">
<meta property="article:published_time" content="2021-11-03T05:40:24.000Z">
<meta property="article:modified_time" content="2021-11-03T06:08:22.000Z">
<meta property="article:author" content="SangHyub Lee, Jose">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://coffeewhale.com/assets/images/k8s-cluster/landing02.png">







<link rel="icon" href="/images/small_geul.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140404038-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-140404038-1');
</script>

    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>

<body class="is-2-column">

    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/small_geul.png" alt="EKS-workshop" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="http://github.com/tkdguq05">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    <div align=center>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 사각 반응 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9443112709859631"
     data-ad-slot="7692350701"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
    
   
    <section class="section">

        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-10-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="https://coffeewhale.com/assets/images/k8s-cluster/landing02.png" alt="EKS-workshop">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2021-11-03T05:40:24.000Z">2021-11-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Engineering/">Engineering</a>
                </div>
                <div align=center>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 사각 반응 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9443112709859631"
     data-ad-slot="7692350701"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    an hour read (About 8563 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                EKS-workshop
            
        </h1>
        <div class="content">
            <p>EKS를 다뤄보고 GitOps까지 실습해봤습니다.</p>
<a id="more"></a>



<ul>
<li><p>실습 링크 : <a href="https://aws-eks-web-application.workshop.aws/ko/10-intro.html">https://aws-eks-web-application.workshop.aws/ko/10-intro.html</a></p>
<p>실습 영상 : <a href="https://www.youtube.com/watch?v=kb6s0Tmp2CA&ab_channel=AWS%ED%95%9C%EA%B5%AD%EC%82%AC%EC%9A%A9%EC%9E%90%EB%AA%A8%EC%9E%84-AWSKRUG">https://www.youtube.com/watch?v=kb6s0Tmp2CA&amp;ab_channel=AWS한국사용자모임-AWSKRUG</a></p>
<blockquote>
<p>AWS 워크샵에서는 다음 내용을 다룹니다.</p>
</blockquote>
<ul>
<li>AWS Cloud9을 통한 실습 환경 구축</li>
<li>도커를 이용하여 컨테이너 이미지 생성</li>
<li>컨테이너 이미지를 ECR에 업로드</li>
<li>Amazon EKS 클러스터 구축 및 서비스 배포</li>
<li>Container Insights 사용해보기</li>
<li>파드 및 클러스터 오토 스케일링</li>
<li>AWS Fargate로 서비스 올리기</li>
</ul>
<p><br></br></p>
<h2 id="Kubernetes-k8s"><a href="#Kubernetes-k8s" class="headerlink" title="Kubernetes(k8s)"></a>Kubernetes(k8s)</h2><ul>
<li>쿠버네티스는 컨테이너화된 워크로드와 서비스를 관리하기 위한 이식성이 있고, 확장가능한 오픈소스 플랫폼입니다. 쿠버네티스는 선언적 구성과 자동화를 모두 용이하게 해주는 컨테이너 오케스트레이션 툴입니다.</li>
</ul>
<blockquote>
<p>🌐 쿠버네티스에 대해 더 자세히 알고 싶다면 <a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">여기</a> 를 클릭하세요.</p>
</blockquote>
<p><img src="/images/eks-workshop/kuber_architecture.png" alt="쿠버네티스_아키텍쳐"></p>
<ul>
<li>쿠버네티스를 배포하면 <strong>클러스터</strong>를 얻습니다. 그리고 이 클러스터는 <strong>노드들의 집합</strong>입니다. 노드들은 크게 두 가지 유형으로 나눠지는데, 각각이 <strong>컨트롤 플레인</strong>과 <strong>데이터 플레인</strong>입니다.<ul>
<li>컨트롤 플레인(Control Plane)은 워커 노드와 클러스터 내 파드를 관리하고 제어합니다.</li>
<li>데이터 플레인(Data Plane)은 <strong>워커 노드들</strong>로 구성되어 있으며 컨테이너화된 애플리케이션의 구성 요소인 <strong>파드</strong>를 호스트합니다.</li>
</ul>
</li>
</ul>
<p><br></br></p>
<h2 id="Kubernetes-Objects"><a href="#Kubernetes-Objects" class="headerlink" title="Kubernetes Objects"></a>Kubernetes Objects</h2><ul>
<li>쿠버네티스의 오브젝트는 <strong>바라는 상태(desired state)를 담은 레코드</strong>입니다. 오브젝트를 생성하면 쿠버네티스의 컨트롤 플레인에서 오브젝트의 <strong>현재 상태(current state)</strong> 와 바라는 상태를 일치시키기 위해 끊임없이 관리합니다.</li>
<li>쿠버네티스의 오브젝트에는 파드(pod), 서비스(service), 디플로이먼트(Deployment) 등이 있습니다.</li>
</ul>
</li>
</ul>
<p>  <br></br></p>
<h2 id="EKS"><a href="#EKS" class="headerlink" title="EKS"></a>EKS</h2><ul>
<li><p><a href="https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html">Amazon EKS</a>는 Kubernetes를 쉽게 실행할 수 있는 관리형 서비스입니다. Amazon EKS를 사용하시면 AWS 환경에서 Kubernetes 컨트롤 플레인 또는 노드를 직접 설치, 운영 및 유지할 필요가 없습니다.</p>
</li>
<li><p>Amazon EKS는 여러 가용 영역에서 Kubernetes 컨트롤 플레인 인스턴스를 실행하여 고가용성을 보장합니다. 또한, 비정상 컨트롤 플레인 인스턴스를 자동으로 감지하고 교체하며 자동화된 버전 업그레이드 및 패치를 제공합니다.</p>
</li>
<li><p>Amazon EKS는 다양한 AWS 서비스들과 연동하여 애플리케이션에 대한 확장성 및 보안을 제공하는 서비스를 제공합니다.</p>
<ul>
<li>컨테이너 이미지 저장소인 <strong>Amazon ECR(Elastic Container Registry)</strong></li>
<li>로드 분산을 위한 <strong>AWS ELB(Elastic Load Balancing)</strong></li>
<li>인증을 위한 <strong>AWS IAM</strong></li>
<li>격리된 <strong>Amazon VPC</strong></li>
</ul>
</li>
<li><p>Amazon EKS는 오픈 소스 Kubernetes 소프트웨어의 최신 버전을 실행하므로 <strong>Kubernetes 커뮤니티에서 사용되는 플러그인과 툴을 모두 사용</strong>할 수 있습니다. 온프레미스 데이터 센터에서 실행 중인지 퍼블릭 클라우드에서 실행 중인지에 상관없이, Amazon EKS에서 실행 중인 애플리케이션은 표준 Kubernetes 환경에서 실행 중인 애플리케이션과 완벽하게 호환됩니다. 즉, 코드를 수정하지 않고 표준 Kubernetes 애플리케이션을 Amazon EKS로 손쉽게 마이그레이션할 수 있습니다.</p>
</li>
<li><p>이 워크샵을 위해서는 administrator IAM  권한이 필요합니다.</p>
<p><br></br></p>
<h2 id="Cloud9"><a href="#Cloud9" class="headerlink" title="Cloud9"></a>Cloud9</h2></li>
<li><p>AWS Cloud9은 브라우저만으로도 코드를 작성, 실행 및 디버깅할 수 있는 IDE입니다. 코드 편집기, 디버거 및 터미널이 포함되어 있으며 많이 사용되는 프로그래밍 언어를 위한 필수 도구가 사전에 패키징되어 제공되므로, 새로운 프로젝트를 시작하기 위해 파일을 설치하거나 개발 머신을 구성할 필요가 없다는 특징을 가지고 있습니다.</p>
<p><br></br></p>
<h3 id="kubectl"><a href="#kubectl" class="headerlink" title="kubectl"></a>kubectl</h3></li>
<li><p>쿠버네티스 클러스터에 명령을 내리는 CLI입니다.</p>
</li>
<li><p>쿠버네티스는 오브젝트 생성, 수정 혹은 삭제와 관련한 동작을 수행하기 위해 <strong>쿠버네티스 API</strong>를 사용합니다. 이때, kubectl CLI를 사용하면 해당 명령어가 쿠버네티스 API를 호출해 관련 동작을 수행합니다.</p>
<p><br></br></p>
<h3 id="eksctl"><a href="#eksctl" class="headerlink" title="eksctl"></a>eksctl</h3></li>
<li><p><a href="https://eksctl.io/">eksctl</a>이란 EKS 클러스터를 쉽게 생성 및 관리하는 CLI 툴입니다. Go 언어로 쓰여 있으며 CloudFormation 형태로 배포됩니다.</p>
<h3 id="eksctl로-클러스터-생성하기"><a href="#eksctl로-클러스터-생성하기" class="headerlink" title="eksctl로 클러스터 생성하기"></a>eksctl로 클러스터 생성하기</h3></li>
<li><p>eksctl을 사용하여 아무 설정 값을 주지 않고 이 명령어(<code>eksctl create cluster</code>)를 실행하면 default parameter로 클러스터가 배포됩니다.</p>
</li>
<li><p>원하는 설정이 있다면 yaml파일을 만들어서 배포하면 됩니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;</span> <span class="string">EOF</span> <span class="string">&gt; eks-demo-cluster.yaml</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">eksctl.io/v1alpha5</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfig</span></span><br><span class="line"></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">eks-demo</span> <span class="comment"># 생성할 EKS 클러스터명</span></span><br><span class="line"><span class="attr">  region:</span> <span class="string">$&#123;AWS_REGION&#125;</span> <span class="comment"># 클러스터를 생성할 리젼</span></span><br><span class="line"><span class="attr">  version:</span> <span class="string">"1.21"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">vpc:</span></span><br><span class="line"><span class="attr">  cidr:</span> <span class="string">"192.168.0.0/16"</span> <span class="comment"># 클러스터에서 사용할 VPC의 CIDR</span></span><br><span class="line"></span><br><span class="line"><span class="attr">managedNodeGroups:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">node-group</span> <span class="comment"># 클러스터의 노드 그룹명</span></span><br><span class="line"><span class="attr">    instanceType:</span> <span class="string">m5.large</span> <span class="comment"># 클러스터 워커 노드의 인스턴스 타입</span></span><br><span class="line"><span class="attr">    desiredCapacity:</span> <span class="number">3</span> <span class="comment"># 클러스터 워커 노드의 갯수</span></span><br><span class="line"><span class="attr">    volumeSize:</span> <span class="number">10</span>  <span class="comment"># 클러스터 워커 노드의 EBS 용량 (단위: GiB)</span></span><br><span class="line"><span class="attr">    ssh:</span></span><br><span class="line"><span class="attr">      enableSsm:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    iam:</span></span><br><span class="line"><span class="attr">      withAddonPolicies:</span></span><br><span class="line"><span class="attr">        imageBuilder:</span> <span class="literal">true</span> <span class="comment"># AWS ECR에 대한 권한 추가</span></span><br><span class="line">        <span class="comment"># albIngress: true  # albIngress에 대한 권한 추가</span></span><br><span class="line"><span class="attr">        cloudWatch:</span> <span class="literal">true</span> <span class="comment"># cloudWatch에 대한 권한 추가</span></span><br><span class="line"><span class="attr">        autoScaler:</span> <span class="literal">true</span> <span class="comment"># auto scaling에 대한 권한 추가</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cloudWatch:</span></span><br><span class="line"><span class="attr">  clusterLogging:</span></span><br><span class="line"><span class="attr">    enableTypes:</span> <span class="string">["*"]</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>eksctl create cluster -f eks-demo-cluster.yaml</code> 로 배포</p>
</li>
<li><p>노드 확인</p>
<ul>
<li><p><code>kubectl get nodes</code></p>
<p><img src="/images/eks-workshop/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2021-10-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.17.55.png" alt="EKS클러스터 구성"></p>
<ul>
<li>기본적인 EKS 클러스터 구성은 끝났고, 본격적으로 서비스를 배포하고, 유저가 들어오는 통로인 인그레스를 설정해 봅시다.</li>
</ul>
</li>
</ul>
</li>
<li><p>이 상태에서는 클러스터의 노드를 UI에서 확인할 수 없습니다. Console Crediential을 더해줘야 합니다.</p>
</li>
<li><p>Cloud9의 IAM credential을 통해, 클러스터를 생성하였기 때문에 <a href="https://console.aws.amazon.com/eks">Amazon EKS 콘솔창</a>에서 해당 클러스터 정보를 확인하기 위해서는 실제 콘솔에 접근할 IAM entity(사용자 또는 역할)의 AWS Console credential을 클러스터에 추가하는 작업이 필요합니다.</p>
<ul>
<li><code>rolearn=$(aws cloud9 describe-environment-memberships --environment-id=$C9_PID | jq -r &#39;.memberships[].userArn&#39;)</code></li>
<li><code>assumedrolename=$(echo ${rolearn} | awk -F/ &#39;{print $(NF-1)}&#39;)
rolearn=$(aws iam get-role --role-name ${assumedrolename} --query Role.Arn --output text)</code> rolearn에 자신의 arn을 넣어주도록 합시다.</li>
<li>echo ${rolearn}</li>
<li><code>eksctl create iamidentitymapping --cluster eks-demo --arn ${rolearn} --group system:masters --username admin</code> identity 맵핑</li>
<li>kubectl describe configmap -n kube-system aws-auth 적용 확인</li>
</ul>
<p><br></br></p>
<h2 id="Ingress-Controller"><a href="#Ingress-Controller" class="headerlink" title="Ingress Controller"></a>Ingress Controller</h2></li>
<li><p><strong>AWS Load Balancer Controller</strong>는 <strong>구 AWS ALB Ingress Controller</strong>에서 리브랜드된 개념입니다.</p>
</li>
<li><p><strong>인그레스(Ingress)</strong> 는 주로 <strong>클러스터 외부에서 쿠버네티스 내부</strong>로 접근할 때, 요청들을 어떻게 처리할지 정의해놓은 규칙이자 리소스 오브젝트입니다. 한마디로 외부의 요청이 내부로 접근하기 위한 관문의 역할을 하는 것이죠. 외부 요청에 대한 로드 밸런싱, TLS/SSL 인증서 처리, HTTP 경로에 대한 라우팅 등을 설정할 수 있습니다. 인그레스는 L7 영역의 요청을 처리합니다.</p>
</li>
<li><p>쿠버네티스에서 서비스 타입 중, NodePort 혹은 LoadBalancer로도 외부로 노출할 수 있지만 인그레스 없이 서비스를 사용할 경우, 모든 서비스에게 라우팅 규칙 및 TLS/SSL 등의 상세한 옵션들을 적용해야 되죠. 그래서 인그레스가 필요합니다.</p>
<p><img src="/images/eks-workshop/Untitled.png" alt="Ingress"></p>
</li>
<li><p>인그레스는 외부 요청 처리에 대한 규칙들을 설정해놓은 것을 의미하며, 이런 설정이 동작하기 위해서 필요한 것이 <strong>인그레스 컨트롤러</strong>입니다. kube-controller-manager의 일부로 실행되는 다른 컨트롤러와 달리 인그레스 컨트롤러는 클러스터와 함께 생성되진 않습니다. 따라서 직접 구현해야 합니다.</p>
<h3 id="AWS-Load-Balancer-만들기"><a href="#AWS-Load-Balancer-만들기" class="headerlink" title="AWS Load Balancer 만들기"></a>AWS Load Balancer 만들기</h3></li>
<li><p><a href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html">Amazon EKS의 Application Load Balancing</a>이란 클러스터에 인그레스 자원이 생성될 때에 ALB(Application Load Balancer) 및 필요한 자원이 생성되도록 트리거하는 컨트롤러입니다. 인그레스 자원들은 ALB를 구성하여 HTTP 또는 HTTPS 트래픽을 클러스터 내 파드로 라우팅합니다.</p>
<ul>
<li>쿠버네티스의 <code>Ingress</code>의 경우, <code>Application Load Balancers</code>으로 프로비저닝됩니다.</li>
<li>쿠버네티스의 <code>Service</code>의 경우, <code>Network Load Balancers</code>으로 프로비저닝됩니다.</li>
</ul>
</li>
<li><p>AWS Load Balancer 컨트롤러에서 지원하는 <strong>트래픽 모드</strong>는 아래의 두 가지입니다.</p>
<ul>
<li>Instance(default): 클러스터 내 노드를 ALB의 대상으로 등록합니다. ALB에 도달하는 트래픽은 NodePort로 라우팅된 다음 파드로 프록시됩니다.</li>
<li>IP: 파드를 ALB 대상으로 등록합니다. ALB에 도달하는 트래픽은 파드로 <strong>직접</strong> 라우팅됩니다. 해당 트래픽 모드를 사용하기 위해선 <strong>ingress.yaml 파일에 주석을 사용하여 명시적으로 지정해야</strong> 합니다.</li>
</ul>
<p>![Instance Mode, IP Mode](/images/eks-workshop/Untitled 1.png)</p>
<ul>
<li>각종 배포들에 사용할 manifests 디렉토리를 만들어놓고 관리하는 것을 추천합니다.</li>
</ul>
</li>
<li><p>AWS Load Balancer 컨트롤러를 배포하기 전, 우리는 몇 가지 작업을 수행해야 합니다. controller가 워커 노드 위에서 동작되기 때문에 IAM permissions를 통해, AWS ALB/NLB 리소스에 접근할 수 있도록 만들어야 합니다. IAM permissions는 ServiceAccount를 위한 IAM roles를 설치하거나 워커 노드의 IAM roles에 직접적으로 붙일 수 있습니다.</p>
</li>
<li><p>먼저, 클러스터에 대한 <strong>IAM OIDC(OpenID Connect) identity Provider</strong>를 생성합니다. Pod와 같은 클러스터 내 쿠버네티스가 생성한 항목이 API Server 또는 외부 서비스에 인증하는데 사용되는 <strong><a href="https://kubernetes.io/ko/docs/reference/access-authn-authz/service-accounts-admin/">service account</a></strong>에 IAM role을 사용하기 위해, 생성한 클러스터(현재 실습에서의 <em>eks-demo</em>)에 <strong>IAM OIDC provider</strong>가 존재해야 합니다.</p>
<ul>
<li><p>eksctl utils associate-iam-oidc-provider <br>–region ${AWS_REGION} <br>–cluster eks-demo <br>–approve</p>
</li>
<li><p>OIDC provider URL</p>
<ul>
<li>aws eks describe-cluster –name eks-demo –query “cluster.identity.oidc.issuer” –output text</li>
<li>output: <a href="https://oidc.eks.ap-northeast-2.amazonaws.com/id/8A6E78112D7F1C4DC352B1B511DD13CF">https://oidc.eks.ap-northeast-2.amazonaws.com/id/8A6E78112D7F1C4DC352B1B511DD13CF</a><ul>
<li>뒤에 id 부분을 복사해서 다음과 같이 입력합니다.</li>
<li>aws iam list-open-id-connect-providers | grep 8A6E78112D7F1C4DC352B1B511DD13CF</li>
<li>결과 값이 출력되면 <strong>IAM OIDC identity provider</strong>가 클러스터에 생성이 된 것이고, 아무 값도 나타나지 않으면 생성 작업을 수행해야 합니다.</li>
</ul>
</li>
</ul>
</li>
<li><p>AWS Load Balancer Controller에 부여할 IAM Policy를 생성하는 작업을 수행합니다.</p>
<ul>
<li>aws iam create-policy <br>–policy-name AWSLoadBalancerControllerIAMPolicy <br>–policy-document <a href="https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/main/docs/install/iam_policy.json">https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/main/docs/install/iam_policy.json</a></li>
</ul>
</li>
<li><p>AWS Load Balancer Controller를 위한 ServiceAccount를 생성합니다.</p>
<ul>
<li>eksctl create iamserviceaccount <br>–cluster eks-demo <br>–namespace kube-system <br>–name aws-load-balancer-controller <br>–attach-policy-arn arn:aws:iam::$ACCOUNT_ID:policy/AWSLoadBalancerControllerIAMPolicy <br>–override-existing-serviceaccounts <br>–approve</li>
</ul>
</li>
<li><p>AWS Load Balancer controller를 클러스터에 추가하는 작업을 수행합니다. 먼저, 인증서 구성을 웹훅에 삽입할 수 있도록 <strong><a href="https://github.com/jetstack/cert-manager">cert-manager</a></strong>를 설치합니다. <strong>Cert-manager</strong>는 쿠버네티스 클러스터 내에서 TLS인증서를 자동으로 프로비저닝 및 관리하는 오픈 소스입니다.</p>
<ul>
<li>kubectl apply –validate=false -f <a href="https://github.com/jetstack/cert-manager/releases/download/v1.4.1/cert-manager.yaml">https://github.com/jetstack/cert-manager/releases/download/v1.4.1/cert-manager.yaml</a></li>
</ul>
</li>
<li><p>load balancer controller yaml</p>
<ul>
<li>wget <a href="https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.2.1/docs/install/v2_2_1_full.yaml">https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.2.1/docs/install/v2_2_1_full.yaml</a></li>
</ul>
</li>
<li><p>yaml 파일에서 클러스터의 <code>cluster-name</code>을 편집합니다. 본 실습에서는 <strong>eks-demo</strong>로 설정합니다.</p>
<ul>
<li>spec:<br>containers:</li>
<li>args:</li>
<li>–cluster-name=eks-demo # 생성한 클러스터 이름을 입력</li>
<li>–ingress-class=alb<br>image: amazon/aws-alb-ingress-controller:v2.2.0</li>
</ul>
</li>
<li><p>ServiceAccount yaml spec 삭제</p>
<ul>
<li>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>labels:<br><a href="http://app.kubernetes.io/component:">app.kubernetes.io/component:</a> controller<br><a href="http://app.kubernetes.io/name:">app.kubernetes.io/name:</a> aws-load-balancer-controller<br>name: aws-load-balancer-controller<br>namespace: kube-system</li>
</ul>
<hr>
</li>
</ul>
</li>
<li><p>배포</p>
<ul>
<li><code>kubectl apply -f v2_2_1_full.yaml</code></li>
<li>확인 kubectl get deployment -n kube-system aws-load-balancer-controller</li>
<li>서비스 어카운드 확인 kubectl get sa aws-load-balancer-controller -n kube-system -o yaml</li>
</ul>
</li>
<li><p>클러스터 내부에서 필요한 기능들을 위해 실행되는 파드들을 <strong>애드온(Addon)</strong> 이라고 합니다. 애드온에 사용되는 파드들은 디플로이먼트, 리플리케이션 컨트롤러 등에 의해 관리됩니다. 그리고 이 애드온이 사용하는 네임스페이스가 <strong>kube-system</strong>입니다. Yaml 파일에서 네임스페이스를 kube-system으로 명시했기에 위의 명령어로 파드 이름이 도출되면 정상적으로 배포된 것입니다. 또한, 아래의 명령어로 관련 로그를 확인할 수 있습니다.</p>
<ul>
<li>kubectl logs -n kube-system $(kubectl get po -n kube-system | egrep -o “aws-load-balancer[a-zA-Z0-9-]+”)</li>
<li>ALBPOD=$(kubectl get pod -n kube-system | egrep -o “aws-load-balancer[a-zA-Z0-9-]+”)</li>
<li>kubectl describe pod -n kube-system ${ALBPOD}</li>
</ul>
<p><br></br></p>
<h2 id="서비스-배포"><a href="#서비스-배포" class="headerlink" title="서비스 배포"></a>서비스 배포</h2></li>
<li><p>서비스 배포하는 순서는 다음과 같습니다.</p>
<p>![서비스 배포 순서](/images/eks-workshop/Untitled 2.png)</p>
</li>
<li><p>소스 코드 다운로드</p>
</li>
<li><p>Amazon ECR에 각 서비스에 대한 리포지토리 생성</p>
</li>
<li><p>Dockerfile을 포함한 소스 코드 위치에서 컨테이너 이미지 빌드 후, 리포지토리에 푸시</p>
</li>
<li><p>각 서비스에 대한 Deployment, Service, Ingress 매니페스트 파일 생성 및 배포</p>
</li>
<li><p>사용자가 실제 서비스를 접근하는 순서</p>
<p>![사용자가 접근하는 순서](/images/eks-workshop/Untitled 3.png)</p>
</li>
<li><p>우리의 서비스는 두 개의 백엔드가 존재합니다.</p>
<ul>
<li>Flask</li>
<li>Node.js</li>
</ul>
</li>
<li><p>각 백엔드의 API가 잘 동작하는지 확인하고 프론트엔드 배포로 넘어가봅시다.</p>
</li>
</ul>
<p>  <br></br></p>
<h3 id="Flask-배포"><a href="#Flask-배포" class="headerlink" title="Flask 배포"></a>Flask 배포</h3><ul>
<li><p>cd ~/environment/manifests/</p>
</li>
<li><p>deploy manifest</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">flask-deployment.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-flask-backend:latest</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">flask-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/contents/aws"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">     app:</span> <span class="string">demo-flask-backend</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Ingress manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ingress.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"backend-ingress"</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">alb</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/scheme:</span> <span class="string">internet-facing</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/target-type:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/contents</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-flask-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>순서대로 배포</p>
</li>
<li><p><code>kubectl apply -f flask-deployment.yaml
kubectl apply -f flask-service.yaml
kubectl apply -f ingress.yaml</code></p>
</li>
<li><p>echo <a href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=’{.status.loadBalancer.ingress[*].hostname}’)/contents/aws 여기서 나온 주소로 확인</p>
<ul>
<li>ingress object가 배포되는 동안 기다리고 주소로 접속</li>
</ul>
<p>![flask 백엔드 배포](/images/eks-workshop/Untitled 4.png)</p>
<p><br></br></p>
<h3 id="node-js-배포"><a href="#node-js-배포" class="headerlink" title="node.js 배포"></a>node.js 배포</h3></li>
<li><p><strong>deploy manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">nodejs-deployment.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">public.ecr.aws/y7c9e1d2/joozero-repo:latest</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">3000</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">nodejs-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/services/all"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">     app:</span> <span class="string">demo-nodejs-backend</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">      protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ingress manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ingress.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"backend-ingress"</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">alb</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/scheme:</span> <span class="string">internet-facing</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/target-type:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/contents</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-flask-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line">					<span class="comment"># 추가된 부분 확인</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/services</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-nodejs-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>순서대로 배포</p>
<ul>
<li><p><code>kubectl apply -f nodejs-deployment.yaml
kubectl apply -f nodejs-service.yaml
kubectl apply -f ingress.yaml</code></p>
</li>
<li><p>echo <a href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=’{.status.loadBalancer.ingress[*].hostname}’)/services/all</p>
<p>![node.js 백엔드 배포](/images/eks-workshop/Untitled 5.png)</p>
</li>
</ul>
<p><br></br></p>
<h3 id="프론트엔드-배포"><a href="#프론트엔드-배포" class="headerlink" title="프론트엔드 배포"></a>프론트엔드 배포</h3></li>
<li><p>프론트엔드 소스 다운</p>
<p>cd /home/ec2-user/environment<br>git clone <a href="https://github.com/joozero/amazon-eks-frontend.git">https://github.com/joozero/amazon-eks-frontend.git</a></p>
</li>
<li><p>ecr repository 생성</p>
<p>aws ecr create-repository <br>–repository-name demo-frontend <br>–image-scanning-configuration scanOnPush=true <br>–region ${AWS_REGION}</p>
</li>
<li><p>프론트엔드 소스에서 url을 백엔드의 ingress 주소로 변경\</p>
<ul>
<li>App.js<ul>
<li>echo <a href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=’{.status.loadBalancer.ingress[*].hostname}’)/contents/‘${search}’</li>
</ul>
</li>
<li>page/UpperPage.js<ul>
<li>echo <a href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=’{.status.loadBalancer.ingress[*].hostname}’)/services/all</li>
</ul>
</li>
</ul>
</li>
<li><p>cd /home/ec2-user/environment/amazon-eks-frontend<br>npm install<br>npm run build</p>
</li>
<li><p>npm audit fix를 해도 안된다면</p>
<ul>
<li><code>export NODE_OPTIONS=--openssl-legacy-provider</code></li>
</ul>
</li>
<li><p>ECR demo-fronted 로 네이밍 한 뒤, 푸쉬</p>
<ul>
<li>docker build -t demo-frontend .</li>
<li>docker tag demo-frontend:latest$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</li>
<li>docker push $ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</li>
</ul>
</li>
<li><p><strong>fronted배포 manifest</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/home/ec2-user/environment/manifests</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-deployment.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ingress 배포</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ingress.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"backend-ingress"</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">alb</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/scheme:</span> <span class="string">internet-facing</span></span><br><span class="line">    <span class="string">alb.ingress.kubernetes.io/target-type:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/contents</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-flask-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/services</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span>  </span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-nodejs-backend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">            pathType:</span> <span class="string">Prefix</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              service:</span></span><br><span class="line"><span class="attr">                name:</span> <span class="string">"demo-frontend"</span></span><br><span class="line"><span class="attr">                port:</span></span><br><span class="line"><span class="attr">                  number:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>배포</p>
<ul>
<li><code>kubectl apply -f frontend-deployment.yaml
kubectl apply -f frontend-service.yaml
kubectl apply -f ingress.yaml</code></li>
</ul>
<p>![프론트까지 배포 완료](/images/eks-workshop/Untitled 6.png)</p>
<img src="/images/eks-workshop/Untitled 7.png" alt="모든 배포가 완료된 모습" style="zoom:80%;" />

<p><br></br></p>
<h2 id="Fargate"><a href="#Fargate" class="headerlink" title="Fargate"></a>Fargate</h2></li>
</ul>
<p>  <strong>AWS Fargate</strong>는 컨테이너에 적합한 서버리스 컴퓨팅 엔진으로 Amazon Elastic Container Service(ECS) 및 Amazon Elastic Kubernetes Service(EKS)에서 모두 작동합니다. Fargate는 애플리케이션을 빌드하는 데 보다 쉽게 초점을 맞출 수 있도록 해줍니다. Fargate에서는 서버를 프로비저닝하고 관리할 필요가 없어 애플리케이션별로 리소스를 지정하고 관련 비용을 지불할 수 있으며, 계획적으로 애플리케이션을 격리함으로써 보안 성능을 향상시킬 수 있습니다.</p>
<ul>
<li><p>클러스터에 Fargate로 pod를 배포하기 위해서는 pod가 실행될 때 사용하는 하나 이상의 fargate profile을 정의해야 합니다. 즉, fargate profile이란 fargate로 pod를 생성하기 위한 조건을 명시해놓은 프로파일이라고 보시면 됩니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/home/ec2-user/environment/manifestscat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">eks-demo-fargate-profile.yaml---apiVersion:</span> <span class="string">eksctl.io/v1alpha5kind:</span> <span class="attr">ClusterConfigmetadata:</span>  <span class="attr">name:</span> <span class="string">eks-demo</span>  <span class="attr">region:</span> <span class="string">$&#123;AWS_REGION&#125;fargateProfiles:</span>  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">frontend-fargate-profile</span>    <span class="attr">selectors:</span>      <span class="bullet">-</span> <span class="attr">namespace:</span> <span class="string">default</span>        <span class="attr">labels:</span>          <span class="attr">app:</span> <span class="string">frontend-fargateEOF</span></span><br></pre></td></tr></table></figure>

<ul>
<li>yaml 파일에서 <strong>selectors</strong>에 기재된 조건에 부합하는 pod의 경우, fargate로 배포됩니다.</li>
</ul>
</li>
<li><p>아래의 명령어를 통해, fargate profile을 프로비저닝합니다.</p>
<ul>
<li>eksctl create fargateprofile -f eks-demo-fargate-profile.yaml</li>
<li>정상 동작 확인<ul>
<li>eksctl get fargateprofile –cluster eks-demo -o json</li>
</ul>
</li>
</ul>
</li>
<li><p>배포한 3개의 pod 중, 프론트앤드 pod를 fargate로 프로비저닝하는 작업을 수행하겠습니다. 먼저, 기존의 pod를 삭제하는 작업을 수행합니다. 아래의 명령어를 yaml 파일이 위치한 폴더에서 작업합니다.</p>
<ul>
<li>kubectl delete -f frontend-deployment.yaml</li>
</ul>
</li>
<li><p>그리고 frontend-deployment.yaml 파일을 수정합니다. 이 yaml파일에서 미리 등록한 fargate profile을 넣어주겠습니다. label값을 frontend-fargate로 변경해야 합니다. 1번에서 key 값이 app이고 value 값이 frontend-fargate이며 namespace가 default일 때, pod를 fargate로 배포하겠다는 조건을 맞추기 위해 값을 변경하였습니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/home/ec2-user/environment/manifestscat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-deployment.yaml---apiVersion:</span> <span class="string">apps/v1kind:</span> <span class="attr">Deploymentmetadata:</span>  <span class="attr">name:</span> <span class="string">demo-frontend</span>  <span class="attr">namespace:</span> <span class="attr">defaultspec:</span>  <span class="attr">replicas:</span> <span class="number">3</span>  <span class="attr">selector:</span>    <span class="attr">matchLabels:</span>      <span class="attr">app:</span> <span class="string">frontend-fargate</span>  <span class="attr">template:</span>    <span class="attr">metadata:</span>      <span class="attr">labels:</span>        <span class="attr">app:</span> <span class="string">frontend-fargate</span>    <span class="attr">spec:</span>      <span class="attr">containers:</span>        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo-frontend</span>          <span class="attr">image:</span> <span class="string">$ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/demo-frontend:latest</span>          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span>          <span class="attr">ports:</span>            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>frontend-service.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">frontend-service.yaml---apiVersion:</span> <span class="attr">v1kind:</span> <span class="attr">Servicemetadata:</span>  <span class="attr">name:</span> <span class="string">demo-frontend</span>  <span class="attr">annotations:</span>    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/"</span><span class="attr">spec:</span>  <span class="attr">selector:</span>    <span class="attr">app:</span> <span class="string">frontend-fargate</span>  <span class="attr">type:</span> <span class="string">NodePort</span>  <span class="attr">ports:</span>    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span>      <span class="attr">port:</span> <span class="number">80</span>      <span class="attr">targetPort:</span> <span class="number">80</span><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>매니페스트 배포</p>
<p><code>kubectl apply -f frontend-deployment.yaml
kubectl apply -f frontend-service.yaml</code></p>
</li>
<li><p>배포 상태 확인</p>
<ul>
<li>kubectl get po -o wide</li>
</ul>
</li>
<li><p>이전과 같은 상태인지 웹 확인</p>
<ul>
<li>echo <a href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=’{.status.loadBalancer.ingress[*].hostname}’)</li>
</ul>
<p><br></br></p>
<h2 id="GitOps"><a href="#GitOps" class="headerlink" title="GitOps?"></a>GitOps?</h2></li>
<li><p>쿠버네티스 환경에서 CI/CD를 위해서는 Git과 워크플로우 툴의 연결이 필요하고, 이를 통해서 자동화 하는 방안이 필요합니다.</p>
</li>
<li><p>일일이 수정하는 것은 너무나 번거롭습니다.</p>
</li>
<li><p>그래서 등장한 것이 GitOps입니다.</p>
</li>
<li><p>Github Action, Kustomize, Helm Chart, Argo CD를 활용해 GitOps를 체험해보겠습니다.</p>
<p><br></br></p>
<h2 id="GitOps-전에-알아야-할-개념들"><a href="#GitOps-전에-알아야-할-개념들" class="headerlink" title="GitOps 전에 알아야 할 개념들"></a>GitOps 전에 알아야 할 개념들</h2></li>
<li><p>앞서 소개한 Kustomize나 Argo CD등은 조금 생소해 보입니다.</p>
</li>
<li><p>이해를 위해 미리 한번 정리를 하고 넘어가보겠습니다.</p>
<h3 id="Kustomize"><a href="#Kustomize" class="headerlink" title="Kustomize"></a>Kustomize</h3></li>
<li><p>Kubernetes에서 app을 배포를 할때 manifest 파일을 작성한다</p>
</li>
<li><p>staging 환경에 배포하는 요구사항이 발생하고, 수정사항이 계속 발생한다면, 작업을 반복해야 하는 이슈가 생긴다</p>
</li>
<li><p>관리해야할 manifest파일이 3배가 되어버림</p>
</li>
<li><p>겹치는 내용이 대부분인데, 이것을 base라고 하고, 환경마다 차이가 나는 부분을 overlay로 관리해보자</p>
</li>
<li><p>kustomize는 이렇게, 공통 부분과 차이가 나는 부분을 분리하는 것에서 시작한다.</p>
</li>
<li><p>base와 overlay를 머지하면서 환경마다 다른 spec의 리소스를 생성하게 된다.</p>
</li>
<li><p>개발 환경마다 소스 구분하여 configmap, secret생성이 가능하다</p>
</li>
<li><p>resource이름에 prefix를 추가하는 기능도 제공한다</p>
</li>
<li><p>Kustomize를 적용해서 직접 수동으로 배포할 수도 있다</p>
<ul>
<li>GitOps로 ArgoCD나 Flux등을 사용해서 배포과정을 자동화 한다.</li>
<li>Flux 는 쿠버네티스 클러스터가 설정 소스(git..)와 동기화된 상태를 유지하고 새 코드가 추가되면 자동으로 업데이트 해주는 도구</li>
</ul>
<p><br></br></p>
<h3 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h3></li>
<li><p>쿠버네티스 패키지 관리를 도와줌</p>
<ul>
<li>npm, pip와 비슷한 역할</li>
</ul>
</li>
<li><p>Chart: 헬름 패키지</p>
<ul>
<li>kubernetes를 설명하는 파일들의 집합</li>
<li>kubernetes에서 app이 동작하기 위한 모든 리소스들이 포함되어 있음</li>
</ul>
</li>
<li><p>Repository</p>
<ul>
<li>차트 저장소, 차트르 모아두고 공유함</li>
</ul>
</li>
<li><p>Release</p>
<ul>
<li>kubernetes 클러스터에서 구동되는 차트 인스턴스</li>
<li>동일한 차트를 여러번 설치할 수 있고 이는 새 릴리즈로 관리됩니다.</li>
<li>릴리즈 될 때 패키지된 차트와 config가 결합되어 정상 실행 됩니다</li>
</ul>
</li>
<li><p>작업 순서</p>
<ul>
<li>Helm 차트를 원하는 레포에서 검색 후 설치 → 각 설치에 따른 새로운 릴리즈 생성</li>
</ul>
<p><br></br></p>
<h3 id="Argo-CD"><a href="#Argo-CD" class="headerlink" title="Argo CD"></a>Argo CD</h3></li>
<li><p>Continuous Delivery</p>
<ul>
<li>지속적 통합을 통해 테스트 되고 빌드된 코드를 지속적으로 전달하여 제품의 질적 향상을 향하는 것</li>
</ul>
</li>
<li><p>쿠버네티스 운영과 관련된 manifest 파일 관리하고 있는 원격 레포지토리를 조회</p>
</li>
<li><p>변경 내역이 감지되면 이를 반영하여 배포함(Auto Sync 옵션)</p>
</li>
<li><p>히스토리를 저장하고, 롤백이 가능함</p>
<p><img src="/images/eks-workshop/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2021-11-03_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.46.28.png" alt="Dev, Ops Pipeline"></p>
</li>
<li><p>argo의 장점</p>
<ul>
<li>실행 단위가 컨테이너기 때문에 고립성이 높다<ul>
<li>개별 작업마다 실행환경이 다양한 경우 실행환경이 섞이지 않고 단독적인 환경을 제공할 수 있다.</li>
<li>하나의 역할을 담당하는 Job을 단일하게 개발할 수 있어 재사용성을 높일 수 있다.<ul>
<li>데이터 입출만 잘 맞춰 놓으면 단일 역할을 하는 Job을 여러개 만들고, 블록처럼 쌓을 수 있다.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>argo의 단점</p>
<ul>
<li>Pod를 생성하고 삭제하는 비용이 크다.<ul>
<li>간단한 작업이라면 프로세스 또는 스레드 레벨에서 처리하는 게 효율적일 때가 있다</li>
</ul>
</li>
<li>각 스텝마다 개별적인 컨테이너를 실행해서 Job간에 데이터를 빠르게 공유하는 것이 힘들다.<ul>
<li>Pod 내부 컨테이너 간에만 volume공유가 가능하다</li>
</ul>
</li>
</ul>
</li>
<li><p>데이터 파이프라인 및 기계학습 모델 훈련에 활용 가능</p>
<ul>
<li>데이터 타입에 따라 추출하는 소스에 따라 상이한 실행환경<ul>
<li>데이터 추출 - Apache sqoop(Java runtime, hadoop 라이브러리 필요)<ul>
<li>S3 - aws cli, boto3…</li>
</ul>
</li>
<li>ML<ul>
<li>python</li>
<li>R</li>
</ul>
</li>
</ul>
</li>
<li>고립성이 굉장히 좋기 때문에 ML워크플로우 툴로도 활용이 가능함</li>
</ul>
<p><br></br></p>
<h2 id="GitOps-실습"><a href="#GitOps-실습" class="headerlink" title="GitOps 실습"></a>GitOps 실습</h2></li>
<li><p>목표하는 CI/CD 파이프라인은 다음과 같습니다.</p>
<img src="/images/eks-workshop/Untitled 8.png" alt="CI/CD" style="zoom:50%;" />
</li>
<li><p>개발에서 작업한 내용은 Github Action을 통해 ECR에 업로드 되고, 이것을 클러스터 Ops쪽에서 Pull을 받아 k8s에 argo CD를 사용해 배포하는 방식입니다.</p>
</li>
<li><p>필요한 레포는 두 가지 입니다. application용과 k8s 메니페스트 관리용 레포입니다.</p>
<ul>
<li><strong><em>front-app-repo</em></strong>: Frontend 소스가 위치한 레파지토리</li>
<li><strong><em>k8s-manifest-repo</em></strong>: K8S 관련 메니페스트가 위치한 레파지토리</li>
</ul>
</li>
<li><p>git remote를 위해서 cloud9에 있는 amazon-eks-frontend 디렉토리 git을 초기화 합니다.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>rm -rf .git</li>
<li>소스 파일들을 푸시합니다.<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git init<br>git add .<br>git commit -m “first commit”<br>git branch -M main<br>git remote add origin <a href="https://github.com/jinseo-jang/front-app-repo.git">https://github.com/jinseo-jang/front-app-repo.git</a><br>git push -u origin main</li>
</ul>
</li>
</ul>
</li>
<li><p>CI/CD 파이프라인을 위해서는 권한이 필요합니다.</p>
<ul>
<li><p>front app을 빌드하고 docker image로 만들어지면, 이것을 ECR로 푸시해야 합니다.</p>
</li>
<li><p>이 과정은 github Action으로 이루어지기 때문에 최소한의 권한을 넣어줍니다.</p>
<ul>
<li><p>IAM  user 생성</p>
<ul>
<li>aws iam create-user –user-name github-action</li>
</ul>
</li>
<li><p>ECR policy 생성</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environmentcat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">ecr-policy.json&#123;</span>    <span class="string">"Version"</span><span class="string">:</span> <span class="string">"2012-10-17"</span><span class="string">,</span>    <span class="string">"Statement"</span><span class="string">:</span> <span class="string">[</span>        <span class="string">&#123;</span>            <span class="string">"Sid"</span><span class="string">:</span> <span class="string">"AllowPush"</span><span class="string">,</span>            <span class="string">"Effect"</span><span class="string">:</span> <span class="string">"Allow"</span><span class="string">,</span>            <span class="string">"Action"</span><span class="string">:</span> <span class="string">[</span>                <span class="string">"ecr:GetDownloadUrlForLayer"</span><span class="string">,</span>                <span class="string">"ecr:BatchGetImage"</span><span class="string">,</span>                <span class="string">"ecr:BatchCheckLayerAvailability"</span><span class="string">,</span>                <span class="string">"ecr:PutImage"</span><span class="string">,</span>                <span class="string">"ecr:InitiateLayerUpload"</span><span class="string">,</span>                <span class="string">"ecr:UploadLayerPart"</span><span class="string">,</span>                <span class="string">"ecr:CompleteLayerUpload"</span>            <span class="string">],</span>            <span class="string">"Resource"</span><span class="string">:</span> <span class="string">"arn:aws:ecr:ap-northeast-2:$&#123;ACCOUNT_ID&#125;:repository/demo-frontend"</span>        <span class="string">&#125;,</span>        <span class="string">&#123;</span>            <span class="string">"Sid"</span><span class="string">:</span> <span class="string">"GetAuthorizationToken"</span><span class="string">,</span>            <span class="string">"Effect"</span><span class="string">:</span> <span class="string">"Allow"</span><span class="string">,</span>            <span class="string">"Action"</span><span class="string">:</span> <span class="string">[</span>                <span class="string">"ecr:GetAuthorizationToken"</span>            <span class="string">],</span>            <span class="string">"Resource"</span><span class="string">:</span> <span class="string">"*"</span>        <span class="string">&#125;</span>    <span class="string">]&#125;EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>이 파일을 사용해 IAM 정책을 생성합니다. 이름은 <code>ecr-policy</code> 입니다.</p>
<ul>
<li>aws iam create-policy –policy-name ecr-policy –policy-document file://ecr-policy.json</li>
</ul>
</li>
<li><p>만든 정책을 IAM 유저에게 넣어줍니다.</p>
<ul>
<li>aws iam attach-user-policy –user-name github-action –policy-arn arn:aws:iam::${ACCOUNT_ID}:policy/ecr-policy</li>
</ul>
</li>
</ul>
</li>
<li><p>Github Secret 생성</p>
<ul>
<li>이제 github action에서 사용할 AWS credential, github token을 설정해줍니다.</li>
<li>AWS credential 생성<ul>
<li>이 또한 최소한의 권한을 갖는 유저를 만들어 줍니다. 이름은 <code>github-action</code>입니다.</li>
<li>aws iam create-access-key –user-name github-action</li>
<li>생성된 accesskey와 secretkey를 저장해놓습니다.</li>
</ul>
</li>
<li>Github으로 들어가서 PAT를 생성해주고 저장해놓습니다.</li>
<li>front-app-repo로 들어가 Settings에 Secret을 선택합니다.<ul>
<li>이 레포의 secret을 넣어줍니다.</li>
<li>Name은 <code>ACTION_TOKEN</code></li>
<li>Value는 PAT를 넣어줍니다.</li>
<li>마찬가지로 <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code> 도 넣어줍니다.</li>
</ul>
</li>
</ul>
</li>
<li><p>Github Action을 위한 workflow 스크립트를 생성합니다.</p>
<ul>
<li><p>github action을 생성하면 .github/workflows에 만들어지기 때문에 같은 디렉토리를 먼저 만들어줍니다.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>mkdir -p ./.github/workflows</li>
</ul>
</li>
<li><p>실제 build 코드를 작성합니다. <code>build.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/amazon-eks-frontend/.github/workflowscat</span> <span class="string">&gt; build.yaml &lt;&lt;EOFname: Build Fronton:  push:    branches: [ main ]jobs:  build:    runs-on: ubuntu-latest    steps:      - name: Checkout source code        uses: actions/checkout@v2      - name: Check Node v        run: node -v      - name: Build front        run: |          npm install          npm run build      - name: Configure AWS credentials        uses: aws-actions/configure-aws-credentials@v1        with:          aws-access-key-id: \$<span class="template-variable">&#123;&#123; secrets.AWS_ACCESS_KEY_ID &#125;&#125;</span>          aws-secret-access-key: \$<span class="template-variable">&#123;&#123; secrets.AWS_SECRET_ACCESS_KEY &#125;&#125;</span>          aws-region: $AWS_REGION      - name: Login to Amazon ECR        id: login-ecr        uses: aws-actions/amazon-ecr-login@v1      - name: Get image tag(verion)        id: image        run: |          VERSION=\$(echo \$<span class="template-variable">&#123;&#123; github.sha &#125;&#125;</span> | cut -c1-8)          echo VERSION=\$VERSION          echo "::set-output name=version::\$VERSION"      - name: Build, tag, and push image to Amazon ECR        id: image-info        env:          ECR_REGISTRY: \$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry &#125;&#125;</span>          ECR_REPOSITORY: demo-frontend          IMAGE_TAG: \$<span class="template-variable">&#123;&#123; steps.image.outputs.version &#125;&#125;</span>        run: |          echo "::set-output name=ecr_repository::\$ECR_REPOSITORY"          echo "::set-output name=image_tag::\$IMAGE_TAG"          docker build -t \$ECR_REGISTRY/\$ECR_REPOSITORY:\$IMAGE_TAG .          docker push \$ECR_REGISTRY/\$ECR_REPOSITORY:\$IMAGE_TAGEOF</span></span><br></pre></td></tr></table></figure>

<ul>
<li>IMAGE_TAG값은 랜덤으로 생성되어 ECR로 Push됩니다.<ul>
<li>$</li>
</ul>
</li>
</ul>
</li>
<li><p>github action이 잘 동작하는지 테스트 합니다.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git add .<br>git commit -m “Add github action build script”<br>git push origin main</li>
<li></li>
</ul>
</li>
</ul>
</li>
<li><p>Kustomize 사용을 위한 k8s manifest 구조화</p>
<ul>
<li><p>앞서 설명한 대로, kustomize는 manifest를 base와 overlays로 나뉘어 관리합니다.</p>
</li>
<li><p>이 구조를 만들어줍니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environmentmkdir</span> <span class="bullet">-p</span> <span class="string">./k8s-manifest-repo/basemkdir</span> <span class="bullet">-p</span> <span class="string">./k8s-manifest-repo/overlays/devcd</span> <span class="string">~/environment/manifestscp</span> <span class="string">*.yaml</span> <span class="string">../k8s-manifest-repo/basecd</span> <span class="string">../k8s-manifest-repo/basels</span> <span class="bullet">-rlt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><em><code>base</code></em> : kubernetes manifest 원본이 위치한 디렉토리 입니다. 이 안에 위치한 manifest 들은 <em><code>overlays</code></em> 아래에 위치한 <strong>kustomize.yaml</strong> 파일에 담긴 <strong>사용자 지정 설정</strong> 내용에 따라 변경됩니다.</p>
</li>
<li><p><em><code>overlays</code></em> : <strong>사용자 입맛에 맞는</strong> 설정 값이 위치한 디렉토리 입니다. 이 설정은 <strong>kustomize.yaml</strong> 에 담습니다. 이 하위에 있는 <em><code>dev</code></em> 디렉토리는 실습을 위해 만든 것으로, 개발 환경에 적용할 설정 파일을 모아 두기 위함 입니다.</p>
</li>
</ul>
</li>
<li><p>Kustomize manifest 생성</p>
<ul>
<li><p>frontend app에 대한 배포 구성을 할 것이기 때문에 frontend부분만 작업 하겠습니다.</p>
<ul>
<li>frontend-deployment.yaml 과 frontend-service.yaml 파일을 kustomize 를 통해 배포 시점에 의도한 값(e.g. Image Tag)을 반영 할겁니다</li>
<li>반영될 값<ul>
<li><strong><code>metadata.labels</code>:</strong> <code>&quot;env: dev&quot;</code>을 frontend-deployment.yaml, frontend-service.yaml 에 일괄 반영 합니다.</li>
<li><strong><code>spec.selector</code></strong> : <code>&quot;select.app: frontend-fargate&quot;</code> 를 frontend-deployment.yaml, frontend-service.yaml 에 일괄 반영 합니다.</li>
<li><strong><code>spec.template.spec.containers.image</code></strong> : <code>&quot;image: &quot;</code> 값을 새롭게 변경된 Image Tag 정보로 업데이트 합니다.</li>
</ul>
</li>
</ul>
</li>
<li><p>kustomize.yaml 파일을 만들어서 관리 변경할 manifest대상을 정의합니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/base</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">kustomization.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kustomize.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Kustomization</span></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">frontend-deployment.yaml</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">frontend-service.yaml</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>overlays/dev 부분에 바꿀 부분을 정의합니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/overlays/dev</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">front-deployment-patch.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">demo-frontend</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    env:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">frontend-fargate</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">frontend-fargate</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/overlays/devcat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">front-service-patch.yamlapiVersion:</span> <span class="attr">v1kind:</span> <span class="attr">Servicemetadata:</span>  <span class="attr">name:</span> <span class="string">demo-frontend</span>  <span class="attr">annotations:</span>    <span class="string">alb.ingress.kubernetes.io/healthcheck-path:</span> <span class="string">"/"</span>  <span class="attr">labels:</span>    <span class="attr">env:</span> <span class="attr">devspec:</span>  <span class="attr">selector:</span>    <span class="attr">app:</span> <span class="string">frontend-fargateEOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>마지막으로 위에서 설정 한 파일들(값)을 사용하고 frontend app 빌드에 따라 만들어진 새로운 <strong>Image Tag</strong> 를 사용 하겠다고 정의 하겠습니다. 구체적으로는, <code>name</code> 에 지정된 image는 <code>newName</code>의 image와 <code>newTag</code>의 값으로 사용 하겠다는 의미 입니다.</p>
</li>
<li><p>이를 활용해 <code>newTag</code> 값을 변경해 새로운 배포가 이루어질 때 마다 이를 kubernetes 클러스터까지 변경 할 수 있습니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/overlays/devcat</span> <span class="string">&lt;&lt;EOF&gt;</span> <span class="string">kustomization.yamlapiVersion:</span> <span class="string">kustomize.config.k8s.io/v1beta1kind:</span> <span class="attr">Kustomizationimages:-</span> <span class="attr">name:</span> <span class="string">$&#123;ACCOUNT_ID&#125;.dkr.ecr.ap-northeast-2.amazonaws.com/demo-frontend</span>  <span class="attr">newName:</span> <span class="string">$&#123;ACCOUNT_ID&#125;.dkr.ecr.ap-northeast-2.amazonaws.com/demo-frontend</span>  <span class="attr">newTag:</span> <span class="attr">abcdefgresources:-</span> <span class="string">../../basepatchesStrategicMerge:-</span> <span class="string">front-deployment-patch.yaml-</span> <span class="string">front-service-patch.yamlEOF</span></span><br></pre></td></tr></table></figure>

<ul>
<li>이상 -patch.yaml 파일에 정의한 내용들은 배포 과정에서 kustomize 에 의해 자동으로 kubernetes manifest 에 반영 됩니다.</li>
<li>이미지의 태그명이 abcdefg로 나오면 성공입니다.</li>
</ul>
</li>
<li><p>kubernetes manifest 용 github repo를 만들어줍니다.</p>
<ul>
<li>k8s-manifefst-repo <strong>**</strong>생성</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/k8s-manifest-repo/git</span> <span class="string">initgit</span> <span class="string">add</span> <span class="string">.git</span> <span class="string">commit</span> <span class="bullet">-m</span> <span class="string">"first commit"</span><span class="string">git</span> <span class="string">branch</span> <span class="bullet">-M</span> <span class="string">maingit</span> <span class="string">remote</span> <span class="string">add</span> <span class="string">origin</span> <span class="attr">https://github.com/jinseo-jang/k8s-manifest-repo.gitgit</span> <span class="string">push</span> <span class="bullet">-u</span> <span class="string">origin</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Argo CD 설치</p>
<ul>
<li>kubectl create namespace argocd<br>kubectl apply -n argocd -f <a href="https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml">https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</a></li>
</ul>
</li>
<li><p>Argo CD cli 설치</p>
<ul>
<li>cd ~/environment<br>VERSION=$(curl –silent “<a href="https://api.github.com/repos/argoproj/argo-cd/releases/latest">https://api.github.com/repos/argoproj/argo-cd/releases/latest</a>“ | grep ‘“tag_name”‘ | sed -E ‘s/.*”([^”]+)”.*/\1/‘)</li>
<li>sudo curl –silent –location -o /usr/local/bin/argocd <a href="https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64">https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64</a></li>
<li>sudo chmod +x /usr/local/bin/argocd</li>
</ul>
</li>
<li><p>Argo CD는 퍼블릭하게 노출되지 않지만, ELB를 통해 접속 가능하도록 만들겠습니다.</p>
<ul>
<li>kubectl patch svc argocd-server -n argocd -p ‘{“spec”: {“type”: “LoadBalancer”}}’</li>
</ul>
</li>
<li><p>접속할 uri를 얻습니다.</p>
<ul>
<li>export ARGOCD_SERVER=<code>kubectl get svc argocd-server -n argocd -o json | jq --raw-output .status.loadBalancer.ingress[0].hostname</code><br>echo $ARGOCD_SERVER</li>
</ul>
</li>
<li><p>기본 username은 admin입니다. password는 다음과 같습니다.</p>
<ul>
<li>ARGO_PWD=<code>kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=&quot;{.data.password}&quot; | base64 -d</code><br>echo $ARGO_PWD</li>
</ul>
</li>
<li><p>argo login</p>
<img src="/images/eks-workshop/Untitled 9.png" alt="login화면" style="zoom:60%;" />
</li>
<li><p>로그인 후 좌 상단 애플리케이션 설정 메뉴를 클릭하고 새 application을 만들어줍니다.</p>
</li>
<li><p><strong>Application Name</strong> 은 <code>eksworkshop-cd-pipeline</code>, <strong>Project</strong>는 <code>default</code>를 입력 합니다.</p>
</li>
<li><p><strong>SOURCE</strong> 섹션의 <strong>Repository URL</strong> 에는 앞서 생성한 <strong><code>k8s-manifest-repo</code>의 git 주소</strong>, <strong>Revision</strong> 에는 <code>main</code>, <strong>Path</strong> 에는 <code>overlays/dev</code>를 입력 합니다.</p>
</li>
<li><p><strong>DESTINATION</strong> 섹션의 <strong>Cluster URL</strong>에는 <code>https://kubernetes.default.svc</code>, <strong>Namespace</strong> 에는 <code>default</code>를 입력 하고 상단의 <strong>Create</strong> 를 클릭 합니다.</p>
</li>
<li><p>eksworkshop-cd-pipeline이 만들어졌습니다.</p>
</li>
<li><p>Kustomize 빌드 단계 추가</p>
<ul>
<li>github action에서 kustomize를 이용하여 image tag를 업데이트 한 후 k8s-manifest-repo에 커밋 푸시하는 단계를 추가 해줘야 합니다.</li>
<li>이 단계가 동작하면, argo CD가 k8s-manifest-repo를 센싱 하다가 새로운 변경사항이 감지되면 Kustomize build 작업을 수행해 새로운 kubernetes manifest를 eks클러스터에 배포합니다.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">~/environment/amazon-eks-frontend/.github/workflows</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF&gt;&gt;</span> <span class="string">build.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">Setup</span> <span class="string">Kustomize</span></span><br><span class="line"><span class="attr">        uses:</span> <span class="string">imranismail/setup-kustomize@v1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">Checkout</span> <span class="string">kustomize</span> <span class="string">repository</span></span><br><span class="line"><span class="attr">        uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"><span class="attr">        with:</span></span><br><span class="line"><span class="attr">          repository:</span> <span class="string">jinseo-jang/k8s-manifest-repo</span></span><br><span class="line"><span class="attr">          ref:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">          token:</span> <span class="string">\$&#123;&#123;</span> <span class="string">secrets.ACTION_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">k8s-manifest-repo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">Update</span> <span class="string">Kubernetes</span> <span class="string">resources</span></span><br><span class="line"><span class="attr">        run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo \$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry &#125;&#125;</span></span></span><br><span class="line"><span class="string">          echo \$<span class="template-variable">&#123;&#123; steps.image-info.outputs.ecr_repository &#125;&#125;</span></span></span><br><span class="line"><span class="string">          echo \$<span class="template-variable">&#123;&#123; steps.image-info.outputs.image_tag &#125;&#125;</span></span></span><br><span class="line"><span class="string">          cd k8s-manifest-repo/overlays/dev/</span></span><br><span class="line"><span class="string">          kustomize edit set image \$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry&#125;&#125;</span>/\$<span class="template-variable">&#123;&#123; steps.image-info.outputs.ecr_repository &#125;&#125;</span>=\$<span class="template-variable">&#123;&#123; steps.login-ecr.outputs.registry&#125;&#125;</span>/\$<span class="template-variable">&#123;&#123; steps.image-info.outputs.ecr_repository &#125;&#125;</span>:\$<span class="template-variable">&#123;&#123; steps.image-info.outputs.image_tag &#125;&#125;</span></span></span><br><span class="line"><span class="string">          cat kustomization.yaml</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span><span class="attr">      - name:</span> <span class="string">Commit</span> <span class="string">files</span></span><br><span class="line"><span class="attr">        run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          cd k8s-manifest-repo</span></span><br><span class="line"><span class="string">          git config --global user.email "github-actions@github.com"</span></span><br><span class="line"><span class="string">          git config --global user.name "github-actions"</span></span><br><span class="line"><span class="string">          git commit -am "Update image tag"</span></span><br><span class="line"><span class="string">          git push -u origin main</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>소스를 만들었으면, 커밋 푸시 해줍니다.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git add .<br>git commit -m “Add kustomize image edit”<br>git push -u origin main</li>
</ul>
</li>
<li><p>github action이 잘 동작하는지를 확인하고, k8s-manifest-repo에 새 manifest가 커밋 되는지 확인합니다.</p>
</li>
<li><p>이렇게 새 manifest가 배포되면, argo CD에서 감지하여, Sync Status가 업데이트 됩니다.</p>
<ul>
<li>아무 설정을 하지 않았다면, <strong>CURRENT SYNC STATUS</strong>의 값이 <strong>Out of Synced</strong> 입니다.</li>
<li>git repository 가 변경되면 자동으로 sync 작업이 수행 하도록 하려면 <strong>Auto-Sync</strong> 를 활성화 해야 합니다. 이를 위해 <strong>APP DETAILS</strong> 로 이동 하여 <strong>ENABLE AUTO-SYNC</strong> 버튼을 눌러 활성화 합니다.</li>
<li>활성화 되었다면, ArgoCD에 의해 k8s-manifest-repo의 커밋 내용이 ArgoCD에 의해 eks클러스터에 반영됩니다.</li>
<li>마지막으로 정상적으로 새 manifest가 배포되었는지를 확인하기 위해 k8s-manifest-repo의 커밋 히스토리를 통해 image tag를 살펴봅니다.</li>
<li>abcdefg가 아니라 새로운 태그값으로 들어갔다면 성공입니다.</li>
</ul>
</li>
<li><p>frontend application에 코드를 변경해서, GitOps 파이프라인이 정상 동작하는지를 최종 점검합니다.</p>
</li>
<li><p><strong>amazon-eks-frontend/src/</strong> 로 이동하여 <strong><code>App.js</code></strong> 더블 클릭하여 파일을 오픈 합니다.</p>
<ul>
<li><p><strong>line 67</strong>의 값을 <strong><code>EKS DEMO Blog version Hyuby</code></strong> 로 변경 하고 저장 합니다. 저장은 <strong>ctrl+s</strong> 를 누릅니다.</p>
</li>
<li><p>변경된 소스를 커밋 푸시 합니다.</p>
<ul>
<li>cd ~/environment/amazon-eks-frontend<br>git add .<br>git commit -m “Add new blog version”<br>git push -u origin main</li>
</ul>
</li>
<li><p>Sync작업이 모두 끝나면, url로 접속하여 변경사항을 확인합니다.</p>
<ul>
<li>echo <a href="http://%24/">http://$</a>(kubectl get ingress/backend-ingress -o jsonpath=’{.status.loadBalancer.ingress[*].hostname}’)</li>
<li>짠!</li>
</ul>
<p><img src="/images/eks-workshop/demo_hyuby.png" alt="정상동작 확인!"></p>
</li>
</ul>
<p><br></br></p>
</li>
</ul>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://daddyprogrammer.org/post/14102/argocd-kubernetes-cluster-deploy/">https://daddyprogrammer.org/post/14102/argocd-kubernetes-cluster-deploy/</a></li>
<li><a href="https://junghyeonsu.tistory.com/65">https://junghyeonsu.tistory.com/65</a></li>
<li><a href="https://wookiist.dev/159">https://wookiist.dev/159</a></li>
<li><a href="https://cwal.tistory.com/23">https://cwal.tistory.com/23</a></li>
<li>[<a href="https://coffeewhale.com/kubernetes/workflow/argo/2020/02/14/argo-wf/]">https://coffeewhale.com/kubernetes/workflow/argo/2020/02/14/argo-wf/]</a>(</li>
</ul>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/k8s/" rel="tag">k8s</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2021/11/18/Moving/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">이직의 과정, 그리고 얻은 것</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2021/10/07/docker-hub-limit/">
                <span class="level-item">Docker hub pull limit이 발생했다면?</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<script>
    var disqus_config = function () {
        this.page.url = 'http://tkdguq05.github.io/2021/11/03/EKS-workshop/';
        this.page.identifier = '2021/11/03/EKS-workshop/';
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'https-tkdguq05-github-io' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </div>
</div>
</div>
                
                




<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-3 column-right is-sticky">
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    Catalogue
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#Kubernetes-k8s">
        <span class="has-mr-6">1</span>
        <span>Kubernetes(k8s)</span>
        </a></li><li>
        <a class="is-flex" href="#Kubernetes-Objects">
        <span class="has-mr-6">2</span>
        <span>Kubernetes Objects</span>
        </a></li><li>
        <a class="is-flex" href="#EKS">
        <span class="has-mr-6">3</span>
        <span>EKS</span>
        </a></li><li>
        <a class="is-flex" href="#Cloud9">
        <span class="has-mr-6">4</span>
        <span>Cloud9</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#kubectl">
        <span class="has-mr-6">4.1</span>
        <span>kubectl</span>
        </a></li><li>
        <a class="is-flex" href="#eksctl">
        <span class="has-mr-6">4.2</span>
        <span>eksctl</span>
        </a></li><li>
        <a class="is-flex" href="#eksctl로-클러스터-생성하기">
        <span class="has-mr-6">4.3</span>
        <span>eksctl로 클러스터 생성하기</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Ingress-Controller">
        <span class="has-mr-6">5</span>
        <span>Ingress Controller</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#AWS-Load-Balancer-만들기">
        <span class="has-mr-6">5.1</span>
        <span>AWS Load Balancer 만들기</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#서비스-배포">
        <span class="has-mr-6">6</span>
        <span>서비스 배포</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Flask-배포">
        <span class="has-mr-6">6.1</span>
        <span>Flask 배포</span>
        </a></li><li>
        <a class="is-flex" href="#node-js-배포">
        <span class="has-mr-6">6.2</span>
        <span>node.js 배포</span>
        </a></li><li>
        <a class="is-flex" href="#프론트엔드-배포">
        <span class="has-mr-6">6.3</span>
        <span>프론트엔드 배포</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Fargate">
        <span class="has-mr-6">7</span>
        <span>Fargate</span>
        </a></li><li>
        <a class="is-flex" href="#GitOps">
        <span class="has-mr-6">8</span>
        <span>GitOps?</span>
        </a></li><li>
        <a class="is-flex" href="#GitOps-전에-알아야-할-개념들">
        <span class="has-mr-6">9</span>
        <span>GitOps 전에 알아야 할 개념들</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Kustomize">
        <span class="has-mr-6">9.1</span>
        <span>Kustomize</span>
        </a></li><li>
        <a class="is-flex" href="#Helm">
        <span class="has-mr-6">9.2</span>
        <span>Helm</span>
        </a></li><li>
        <a class="is-flex" href="#Argo-CD">
        <span class="has-mr-6">9.3</span>
        <span>Argo CD</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#GitOps-실습">
        <span class="has-mr-6">10</span>
        <span>GitOps 실습</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Reference">
        <span class="has-mr-6">10.1</span>
        <span>Reference</span>
        </a></li></ul></li></ul>
            </div>
        </div>
    </div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Algorithm/">
            <span class="level-start">
                <span class="level-item">Algorithm</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Algorithm/Automation/">
            <span class="level-start">
                <span class="level-item">Automation</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Engieering/">
            <span class="level-start">
                <span class="level-item">Engieering</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Engineering/">
            <span class="level-start">
                <span class="level-item">Engineering</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ML/">
            <span class="level-start">
                <span class="level-item">ML</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ML/Information-Theory/">
            <span class="level-start">
                <span class="level-item">Information Theory</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ML/Statistics/">
            <span class="level-start">
                <span class="level-item">Statistics</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Statistics/">
            <span class="level-start">
                <span class="level-item">Statistics</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/blog/">
            <span class="level-start">
                <span class="level-item">blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/blog/airflow/">
            <span class="level-start">
                <span class="level-item">airflow</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/blog/event/">
            <span class="level-start">
                <span class="level-item">event</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/book/">
            <span class="level-start">
                <span class="level-item">book</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/book/ML/">
            <span class="level-start">
                <span class="level-item">ML</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/cicd/">
            <span class="level-start">
                <span class="level-item">cicd</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/cicd/engineering/">
            <span class="level-start">
                <span class="level-item">engineering</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/coding-test/">
            <span class="level-start">
                <span class="level-item">coding test</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/coding-test/Algorithm/">
            <span class="level-start">
                <span class="level-item">Algorithm</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/cs/">
            <span class="level-start">
                <span class="level-item">cs</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/cs/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/engineering/">
            <span class="level-start">
                <span class="level-item">engineering</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/engineering/GCP/">
            <span class="level-start">
                <span class="level-item">GCP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/event/">
            <span class="level-start">
                <span class="level-item">event</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/infra/">
            <span class="level-start">
                <span class="level-item">infra</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/infra/backend/">
            <span class="level-start">
                <span class="level-item">backend</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/linux/">
            <span class="level-start">
                <span class="level-item">linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/linux/engineering/">
            <span class="level-start">
                <span class="level-item">engineering</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/papers/">
            <span class="level-start">
                <span class="level-item">papers</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/python/coding-test/">
            <span class="level-start">
                <span class="level-item">coding test</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/cs/">
            <span class="level-start">
                <span class="level-item">cs</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/recommender/">
            <span class="level-start">
                <span class="level-item">recommender</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/spark/">
            <span class="level-start">
                <span class="level-item">spark</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/spark/engineering/">
            <span class="level-start">
                <span class="level-item">engineering</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/sql/">
            <span class="level-start">
                <span class="level-item">sql</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/sql/code/">
            <span class="level-start">
                <span class="level-item">code</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/sql/debug/">
            <span class="level-start">
                <span class="level-item">debug</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/trouble-shooting/">
            <span class="level-start">
                <span class="level-item">trouble shooting</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/trouble-shooting/study/">
            <span class="level-start">
                <span class="level-item">study</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ubuntu/troubleshooting/">
            <span class="level-start">
                <span class="level-item">troubleshooting</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/%EA%B8%80%EB%98%90/">
            <span class="level-start">
                <span class="level-item">글또</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/%EA%B8%80%EB%98%90/blog/">
            <span class="level-start">
                <span class="level-item">blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/A-B-test/" style="font-size: 10px;">A/B test</a> <a href="/tags/AWS/" style="font-size: 12px;">AWS</a> <a href="/tags/Accuracy/" style="font-size: 10px;">Accuracy</a> <a href="/tags/Ada-Boosting/" style="font-size: 10px;">Ada Boosting</a> <a href="/tags/Boosting/" style="font-size: 10px;">Boosting</a> <a href="/tags/Cross-Entropy/" style="font-size: 10px;">Cross Entropy</a> <a href="/tags/Dimensional-Reduction/" style="font-size: 10px;">Dimensional Reduction</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ECS/" style="font-size: 10px;">ECS</a> <a href="/tags/EMR/" style="font-size: 10px;">EMR</a> <a href="/tags/Ensemble/" style="font-size: 10px;">Ensemble</a> <a href="/tags/Entropy/" style="font-size: 12px;">Entropy</a> <a href="/tags/GCP/" style="font-size: 10px;">GCP</a> <a href="/tags/GDG/" style="font-size: 10px;">GDG</a> <a href="/tags/Gradient-Boosting/" style="font-size: 10px;">Gradient Boosting</a> <a href="/tags/IaC/" style="font-size: 10px;">IaC</a> <a href="/tags/Information/" style="font-size: 12px;">Information</a> <a href="/tags/Information-Value/" style="font-size: 10px;">Information Value</a> <a href="/tags/KL-Divergence/" style="font-size: 10px;">KL Divergence</a> <a href="/tags/Linear-Regression/" style="font-size: 10px;">Linear Regression</a> <a href="/tags/MAB/" style="font-size: 10px;">MAB</a> <a href="/tags/Metrics/" style="font-size: 10px;">Metrics</a> <a href="/tags/NLP/" style="font-size: 10px;">NLP</a> <a href="/tags/Naive-Bayes/" style="font-size: 10px;">Naive Bayes</a> <a href="/tags/PCA/" style="font-size: 10px;">PCA</a> <a href="/tags/RandomForest/" style="font-size: 10px;">RandomForest</a> <a href="/tags/Supervised-Learning/" style="font-size: 10px;">Supervised Learning</a> <a href="/tags/Task/" style="font-size: 10px;">Task</a> <a href="/tags/Timeseries/" style="font-size: 14px;">Timeseries</a> <a href="/tags/Virtualization/" style="font-size: 10px;">Virtualization</a> <a href="/tags/airflow/" style="font-size: 18px;">airflow</a> <a href="/tags/backend/" style="font-size: 10px;">backend</a> <a href="/tags/blog/" style="font-size: 20px;">blog</a> <a href="/tags/class/" style="font-size: 10px;">class</a> <a href="/tags/code/" style="font-size: 16px;">code</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/devtron/" style="font-size: 10px;">devtron</a> <a href="/tags/elice/" style="font-size: 12px;">elice</a> <a href="/tags/engineering/" style="font-size: 10px;">engineering</a> <a href="/tags/etcd/" style="font-size: 10px;">etcd</a> <a href="/tags/feature-selection/" style="font-size: 10px;">feature selection</a> <a href="/tags/float/" style="font-size: 10px;">float</a> <a href="/tags/gitops/" style="font-size: 10px;">gitops</a> <a href="/tags/infra/" style="font-size: 10px;">infra</a> <a href="/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/keras/" style="font-size: 10px;">keras</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/mongoDB/" style="font-size: 10px;">mongoDB</a> <a href="/tags/mysql/" style="font-size: 12px;">mysql</a> <a href="/tags/network/" style="font-size: 12px;">network</a> <a href="/tags/oop/" style="font-size: 10px;">oop</a> <a href="/tags/paper/" style="font-size: 12px;">paper</a> <a href="/tags/programmers/" style="font-size: 14px;">programmers</a> <a href="/tags/python/" style="font-size: 16px;">python</a> <a href="/tags/recommender/" style="font-size: 10px;">recommender</a> <a href="/tags/retrospect/" style="font-size: 10px;">retrospect</a> <a href="/tags/server/" style="font-size: 14px;">server</a> <a href="/tags/spark/" style="font-size: 12px;">spark</a> <a href="/tags/sql/" style="font-size: 12px;">sql</a> <a href="/tags/trouble-shooting/" style="font-size: 10px;">trouble shooting</a> <a href="/tags/ubuntu/" style="font-size: 14px;">ubuntu</a> <a href="/tags/vision/" style="font-size: 10px;">vision</a> <a href="/tags/yaml/" style="font-size: 10px;">yaml</a> <a href="/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/tags/%EA%B8%80%EB%98%90/" style="font-size: 16px;">글또</a> <a href="/tags/%EA%B8%B0%EB%A1%9D/" style="font-size: 10px;">기록</a> <a href="/tags/%EB%8B%A4%EC%A7%90/" style="font-size: 10px;">다짐</a>
    </div>
</div>
    
    
</div>

                <div align=center>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 사각 반응 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9443112709859631"
     data-ad-slot="7692350701"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
            </div>
        </div>
    <div align=center>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 사각 반응 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9443112709859631"
     data-ad-slot="7692350701"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
    </section>
    
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/small_geul.png" alt="EKS-workshop" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2022 SangHyub Lee, Jose&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://tkdguq05.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

</body>
</html>