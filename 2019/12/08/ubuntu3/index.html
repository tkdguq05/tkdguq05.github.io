<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>ubuntu를 이용한 딥러닝 Server 설치하기 3 - Unreasonable Effectiveness</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Unreasonable Effectiveness"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Unreasonable Effectiveness"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="본격적으로 딥러닝을 하기 위한 준비과정"><meta property="og:type" content="article"><meta property="og:title" content="ubuntu를 이용한 딥러닝 Server 설치하기 3"><meta property="og:url" content="http://tkdguq05.github.io/2019/12/08/ubuntu3/"><meta property="og:site_name" content="Unreasonable Effectiveness"><meta property="og:description" content="본격적으로 딥러닝을 하기 위한 준비과정"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://tkdguq05.github.io/images/ubuntu_logo.png"><meta property="article:published_time" content="2019-12-08T06:57:40.000Z"><meta property="article:modified_time" content="2020-02-24T10:22:01.000Z"><meta property="article:author" content="SangHyub Lee, Jose"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="server"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://tkdguq05.github.io/images/ubuntu_logo.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://tkdguq05.github.io/2019/12/08/ubuntu3/"},"headline":"ubuntu를 이용한 딥러닝 Server 설치하기 3","image":["http://tkdguq05.github.io/images/ubuntu_logo.png"],"datePublished":"2019-12-08T06:57:40.000Z","dateModified":"2020-02-24T10:22:01.000Z","author":{"@type":"Person","name":"SangHyub Lee, Jose"},"publisher":{"@type":"Organization","name":"Unreasonable Effectiveness","logo":{"@type":"ImageObject"}},"description":"본격적으로 딥러닝을 하기 위한 준비과정"}</script><link rel="canonical" href="http://tkdguq05.github.io/2019/12/08/ubuntu3/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Unreasonable Effectiveness</a></div><div class="navbar-menu"><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-12-08T06:57:40.000Z" title="2019. 12. 8. 오후 3:57:40">2019-12-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-02-24T10:22:01.000Z" title="2020. 2. 24. 오후 7:22:01">2020-02-24</time></span><span class="level-item"><a class="link-muted" href="/categories/ubuntu/">ubuntu</a><span> / </span><a class="link-muted" href="/categories/ubuntu/troubleshooting/">troubleshooting</a></span></div></div><h1 class="title is-3 is-size-4-mobile">ubuntu를 이용한 딥러닝 Server 설치하기 3</h1><div class="content"><p>본격적으로 딥러닝을 하기 위한 준비과정</p>
<a id="more"></a>
<h1 id="Installation-of-Ubuntu-18-04-LTS-for-Deep-Learning-Computer-2"><a href="#Installation-of-Ubuntu-18-04-LTS-for-Deep-Learning-Computer-2" class="headerlink" title="Installation of Ubuntu 18.04 LTS for Deep Learning Computer -2"></a>Installation of Ubuntu 18.04 LTS for Deep Learning Computer -2</h1><h2 id="Ubuntu-with-mac-원격-접속-연결하기"><a href="#Ubuntu-with-mac-원격-접속-연결하기" class="headerlink" title="Ubuntu with mac, 원격 접속 연결하기"></a>Ubuntu with mac, 원격 접속 연결하기</h2><p>저번 글에서는 공유기를 이용한 고정ip설정과 포트포워딩, 원격 접속, 원격 파일 전송에 대해서 알아봤습니다. 이번 글에서는 본격적으로 딥러닝을 하기 위한 Cuda와 CuDnn, tensorflow, keras 설치에 이어 jupyter notebook 연결까지 해보겠습니다.</p>
<p>설치하는 순서는 다음과 같습니다.</p>
<ul>
<li>nvidia 그래픽 드라이버 설치</li>
<li>Cuda 설치</li>
<li>CuDnn 설치</li>
<li>tensorflow, keras 설치</li>
<li>jupyter notebook 연결</li>
</ul>
<h2 id="1-nvidia-그래픽-드라이버-설치"><a href="#1-nvidia-그래픽-드라이버-설치" class="headerlink" title="1. nvidia 그래픽 드라이버 설치"></a>1. nvidia 그래픽 드라이버 설치</h2><p>그래픽 드라이버 설치는 겜돌이들에게는 너무나 익숙한 일입니다. 예전엔가 카트를 하고 싶었는데 화면이 까맣게 나와서 네이버 지식인에 물어봤더니 드라이버 설치를 하라고 했던 기억이 나네요. 그래픽 드라이버 회사의 사이트로 들어가서 그래픽 드라이버를 받아서 설치하면 끝입니다. 같은 방식으로 Ubuntu 서버에도 그래픽 드라이버 종류를 알아본 뒤에, 이에 맞는 드라이버를 받아서 설치해주면 됩니다. 하지만 설치를 잘못하게 되면 검은화면에서 뚝뚝뚝 에러메서지만 흘러나오며 엔터키도 먹지 않는 악몽을 경험하게 될 것입니다. </p>
<p>자신의 그래픽 카드가 뭔지는 컴퓨터를 사신 분이 잘 아실 것입니다. 그 정보를 가지고 <a target="_blank" rel="noopener" href="http://www.nvidia.com/Download/Find.aspx?lang=en-us">http://www.nvidia.com/Download/Find.aspx?lang=en-us</a> nvidia 홈페이지에 접속한 후에 그래픽 카드 정보를 입력하고 알맞은 그래픽 드라이버의 Version을 확인 합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-cache search nvidia</span><br></pre></td></tr></table></figure>
<p>서버로 돌아와 다음 명령어를 이용해 설치가능한 드라이버를 확인해 보고 본격적으로 설치해봅니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install nvidia-xxx</span><br></pre></td></tr></table></figure>
<p>이제 xxx에 들어갈 적절한 드라이버 Version을 입력하고 설치를 해주면 됩니다. 보통은 정상적으로 설치가 되는데, </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Errors were encountered while processing:</span><br><span class="line"> nvidia-xxx</span><br><span class="line"> libcuda1-xxx</span><br><span class="line"> nvidia-opencl-icd-xxx</span><br><span class="line">E: Sub-process &#x2F;usr&#x2F;bin&#x2F;dpkg returned an error code (1)</span><br></pre></td></tr></table></figure>

<p>이런 식의 에러가 날 수 있습니다. 이런 경우에는 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir /usr/lib/nvidia</span><br><span class="line">$ sudo apt-get install nvidia-xxx</span><br></pre></td></tr></table></figure>
<p>를 이용해서 nvidia 폴더를 만들어주고 설치를 진행하면 됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install dkms nvidia-modprobe</span><br></pre></td></tr></table></figure>
<p>그리고 드라이버 종류에 상관없이 위의 패키지를 설치해주고 그래픽 드라이버가 로드 될 수 있도록 reboot 시켜줍니다.</p>
<p><a target="_blank" rel="noopener" href="https://hiseon.me/linux/ubuntu/install_nvidia_driver/">설치 가이드 출처</a></p>
<h3 id="Trouble-shooting"><a href="#Trouble-shooting" class="headerlink" title="Trouble shooting"></a>Trouble shooting</h3><p>설치 후에 뿌듯 뿌듯한 마음으로 reboot 명령어를 내리고 화면을 천천히 지켜보고 있다 보면, 심상치 않은 메세지가 뚝뚝뚝 나오고 엔터키도 듣지 않는 것처럼 보일 때가 있습니다. 저 또한 멘탈이 깨져버려서 10붕동안은 멍하니 쳐다보고만 있었습니다. </p>
<p>이유는 여러가지가 있겠습니다만, 저의 경우에는 설치된 드라이버 버전이 서버와 맞지 않아서 생기는 문제였습니다. 이럴 경우에는 설치된 드라이버를 삭제하고 다시 설치하는 방법을 생각해 볼 수 있겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt purge nvidia*</span><br></pre></td></tr></table></figure>
<p>위의 명령어로 nvidia관련 드라이버를 싹 날려주고 reboot하여 맞는 드라이버를 설치해 줍니다. </p>
<h2 id="2-Cuda-CuDnn-설치"><a href="#2-Cuda-CuDnn-설치" class="headerlink" title="2.Cuda, CuDnn 설치"></a>2.Cuda, CuDnn 설치</h2><p>이제 CUDA 10.0과 cuDNN 7.5 설치를 진행해봅니다. Cuda는 다음의 명령어로 설치해 줍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cuda-10-0</span><br></pre></td></tr></table></figure>
<p>설치가 되는데 시간이 좀 걸릴 수 있습니다. 설치가 끝나면 제대로 설치가 되었는지를 확인하기 위해서</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc --version</span><br></pre></td></tr></table></figure>
<p>위의 명령어를 이용해 Cuda Compiler정보를 확인합니다. nvcc정보가 잘 나오면 설치가 잘 된 것입니다.</p>
<p>이제 CuDnn을 설치해야 하는데, CuDnn은 Nvidia에서 공개적으로 다운받을 수 있게 해놓지 않았습니다. Nvidia에 회원으로 등록을 해야 CuDnn을 다운 받을 수 있게 해줍니다. 따라서 <a target="_blank" rel="noopener" href="https://developer.nvidia.com/cudnn">https://developer.nvidia.com/cudnn</a> 이 사이트로 들어가 회원가입을 해주고 우리는 Cuda 10.0을 설치해줬으니까 10.0에 맞는 Cudnn 7.5를 다운로드 해줍니다. 다운이 되었으면 저의 경우는 Mac을 이용해서 받았기 때문에, <a href="https://tkdguq05.github.io/2019/11/22/ununtu2/">이전 글</a>에서 다루었던 <code>sftp</code>를 이용해서 파일을 전송했습니다.</p>
<p>파일을 이동시킨 후에 tar로 말려져 있는 파일을 풀어줍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf cudnn-10.0-linux-x64-v7.5.x.x.tgz</span><br></pre></td></tr></table></figure>

<p>7.5뒤의 버전은 다를 수 있으니 잘 확인하시고 수정해 넣으시면 됩니다. 이제 압축을 푼 파일을 cuda폴더에 복사해 넣어줍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -P cuda/lib64/libcudnn* /usr/<span class="built_in">local</span>/cuda-10.0/lib64/</span><br><span class="line"></span><br><span class="line">sudo cp  cuda/include/cudnn.h /usr/<span class="built_in">local</span>/cuda-10.0/include/</span><br></pre></td></tr></table></figure>

<p>마지막으로 이동시킨 파일들에 대한 권한을 부여해주면 됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+r /usr/<span class="built_in">local</span>/cuda-10.0/include/cudnn.h /usr/<span class="built_in">local</span>/cuda-10.0/lib64/libcudnn*</span><br></pre></td></tr></table></figure>

<p>*추가</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#Nvidia에서 필요한 파일이라고 하네요</span><br><span class="line">sudo apt-get install libcupti-dev</span><br></pre></td></tr></table></figure>

<p>bashrc에 환경변수를 추가해주는 글을 많이 봤는데, 저의 경우에는 굳이 입력을 안해도 잘 인식하는 걸 봐서, 넣지 않았습니다. 제대로 불러오지 못한다면 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi ~/.bashrc</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.0&#x2F;bin$&#123;PATH:+:$&#123;PATH&#125;&#125;</span><br><span class="line"></span><br><span class="line">export LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.0&#x2F;lib64\$&#123;LD_LIBRARY_PATH:+:$&#123;LD_LIBRARY_PATH&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>를 추가해 주세요</p>
<h2 id="3-Tensorflow-Keras-설치"><a href="#3-Tensorflow-Keras-설치" class="headerlink" title="3. Tensorflow, Keras 설치"></a>3. Tensorflow, Keras 설치</h2><p>Keras 설치에 앞서, 백엔드로 사용하는 Tensorflow를 설치해 줍니다. 이제 설치는 정말 간단합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade tensorflow-gpu</span><br></pre></td></tr></table></figure>
<p>python3버전의 tensorflow를 설치해줍니다. cpu 버전을 설치하고 싶다면 -gpu를 빼주면 됩니다.</p>
<p>conda 가상환경을 만들었다면, 실행시킨 후에 필요 라이브러리를 설치하고 Keras를 최종적으로 설치하면 끝입니다!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">conda activate your_name</span><br><span class="line">(your_name) conda install h5py</span><br><span class="line">(your_name) conda install graphviz</span><br><span class="line">(your_name) conda install pydot</span><br><span class="line">(your_name) conda install keras</span><br></pre></td></tr></table></figure>

<h2 id="4-Jupyter-Notebook-설치"><a href="#4-Jupyter-Notebook-설치" class="headerlink" title="4. Jupyter Notebook 설치"></a>4. Jupyter Notebook 설치</h2><p>먼저 가상환경으로 들어가주고 pip를 이용해 jupyter notebook을 설치해 줍니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda activate your_name</span><br><span class="line">pip install jupyter notebook</span><br></pre></td></tr></table></figure>

<p>설치가 되었지만, 외부에서 접속을 해서 jupyter notebook을 사용하려면 아직 몇가지 설정이 더 남았습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br></pre></td></tr></table></figure>
<p>를 이용해서 jupyter 설정파일을 만들어 준 후에</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ipython <span class="comment">#입력 후 In[1]이 나오면,</span></span><br><span class="line">from notebook.auth import passwd</span><br><span class="line">Enter password:  <span class="comment">#원하는 비밀번호 입력</span></span><br><span class="line">Verify password: </span><br><span class="line">Out[2]: <span class="string">'sha1:f24baff49ac5:863dd2ae747212ede58125302d227f0ca7b12bb3'</span></span><br></pre></td></tr></table></figure>
<p>이렇게 하고 나면 shai로 시작하는 암호문 같은 게 있습니다. 이걸 복사해서 잘 적어두시고, <code>jupyter_notebook_config.py</code>를 열어서</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># The IP address the notebook server will listen on. </span><br><span class="line">c.NotebookApp.ip &#x3D; &#39;0.0.0.0&#39; </span><br><span class="line">c.NotebookApp.port_retries &#x3D; 50 </span><br><span class="line">c.NotebookApp.port_retries &#x3D; 8888</span><br><span class="line">c.NotebookApp.open_browser &#x3D; False</span><br></pre></td></tr></table></figure>
<p>위와 같이 수정해 주고 <code>jupyter notebook --ip=0.0.0.0</code>으로 실행해주면 jupyter notebook이 짠 하고 등장할 것입니다.</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/linux/">linux</a><a class="link-muted mr-2" rel="tag" href="/tags/ubuntu/">ubuntu</a><a class="link-muted mr-2" rel="tag" href="/tags/server/">server</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/12/22/adios-2019/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2019년도 회고, 2020년을 맞이하며</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/11/22/ununtu2/"><span class="level-item">ubuntu를 이용한 딥러닝 Server 설치하기 2</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Unreasonable Effectiveness</a><p class="is-size-7"><span>&copy; 2023 SangHyub Lee, Jose</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/main.js" defer></script><!--!--></body></html>